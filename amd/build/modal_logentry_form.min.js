define ("local_booking/modal_logentry_form",["jquery","core/event","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","local_booking/events","local_booking/repository"],function(a,b,c,d,e,f,g,h,i,j){var k=!1,l={SAVE_BUTTON:"[data-action=\"save\"]",LOADING_ICON_CONTAINER:"[data-region=\"loading-icon-container\"]"},m=function(a){f.call(this,a);this.logentryId=null;this.sessionDate=null;this.exerciseId=null;this.courseId=null;this.contextId=null;this.studentId=null;this.reloadingBody=!1;this.reloadingTitle=!1;this.saveButton=this.getFooter().find(l.SAVE_BUTTON)};m.TYPE="local_booking-modal_logentry_form";m.prototype=Object.create(f.prototype);m.prototype.constructor=m;m.prototype.setContextId=function(a){this.contextId=a};m.prototype.getContextId=function(){return this.contextId};m.prototype.setCourseId=function(a){this.courseId=a};m.prototype.getCourseId=function(){return this.courseId};m.prototype.hasCourseId=function(){return null!==this.courseId};m.prototype.setExerciseId=function(a){this.exerciseId=a};m.prototype.getExerciseId=function(){return this.exerciseId};m.prototype.hasExerciseId=function(){return null!==this.exerciseId};m.prototype.setStudentId=function(a){this.studentId=a};m.prototype.getStudentId=function(){return this.studentId};m.prototype.hasStudentId=function(){return null!==this.studentId};m.prototype.setLogentryId=function(a){this.logentryId=a};m.prototype.getLogentryId=function(){return this.logentryId};m.prototype.hasLogentryId=function(){return null!==this.logentryId&&0!=this.logentryId};m.prototype.setSessionDate=function(a){this.sessionDate=a};m.prototype.getSessionDate=function(){return this.sessionDate};m.prototype.hasSessionDate=function(){return null!==this.sessionDate};m.prototype.getForm=function(){return this.getBody().find("form")};m.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)};m.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)};m.prototype.reloadTitleContent=function(){if(this.reloadingTitle){return this.titlePromise}this.reloadingTitle=!0;if(this.hasLogentryId()){this.titlePromise=c.get_string("editlogentry","local_booking")}else{this.titlePromise=c.get_string("newlogentry","local_booking")}this.titlePromise.then(function(a){this.setTitle(a);return a}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(d.exception);return this.titlePromise};m.prototype.reloadBodyContent=function(b){if(this.reloadingBody){return this.bodyPromise}this.reloadingBody=!0;this.disableButtons();var c={};if(this.hasStudentId()){c.studentid=this.getStudentId()}if(this.hasLogentryId()){c.logentryid=this.getLogentryId()}if(this.hasSessionDate()){c.sessiondate=this.getSessionDate()}if(this.hasCourseId()){c.courseid=this.getCourseId()}if(this.hasExerciseId()){c.exerciseid=this.getExerciseId()}if("undefined"!=typeof b){c.formdata=b}this.bodyPromise=h.loadFragment("local_booking","logentry_form",this.getContextId(),c);this.setBody(this.bodyPromise);this.bodyPromise.then(function(){this.enableButtons();a(document).ready(function(){var a=document.getElementById("id_flighttimemins"),b=document.getElementById("id_soloflighttimemins"),c=document.getElementById("id_sessiontimemins");Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(a);Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(b);Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(c)})}.bind(this)).fail(d.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(d.exception);return this.bodyPromise};m.prototype.reloadAllContent=function(){return a.when(this.reloadTitleContent(),this.reloadBodyContent())};m.prototype.show=function(){this.reloadAllContent();f.prototype.show.call(this)};m.prototype.hide=function(){f.prototype.hide.call(this);this.setLogentryId(null);this.setSessionDate(null);this.setContextId(null);this.setCourseId(null);this.setExerciseId(null)};m.prototype.getFormData=function(){return this.getForm().serialize()};m.prototype.save=function(){var b,c=this.saveButton.find(l.LOADING_ICON_CONTAINER);b=this.getForm().find("[aria-invalid=\"true\"]");if(b.length){b.first().focus();return}c.removeClass("hidden");this.disableButtons();var e=this.getFormData(),f="contextid="+this.contextId+"&courseid="+this.courseId+"&exerciseid="+this.exerciseId+"&studentid="+this.studentId;return j.submitCreateUpdateLogentryForm(f,e).then(function(b){if(b.validationerror){this.reloadBodyContent(e)}else{var c=this.hasLogentryId();this.hide();if(c){a("body").trigger(i.updated,[b.logentry])}else{a("body").trigger(i.created,[b.logentry])}}}.bind(this)).always(function(){c.addClass("hidden");this.enableButtons()}.bind(this)).fail(d.exception)};m.prototype.registerEventListeners=function(){f.prototype.registerEventListeners.call(this);this.getModal().on(e.events.activate,l.SAVE_BUTTON,function(a,b){this.getForm().submit();b.originalEvent.preventDefault();a.stopPropagation()}.bind(this));this.getModal().on("submit",function(a){b.notifyFormSubmitAjax(this.getForm()[0]);this.save();a.preventDefault();a.stopPropagation()}.bind(this))};if(!k){g.register(m.TYPE,m,"local_booking/modal_logentry_form");k=!0}return m});
//# sourceMappingURL=modal_logentry_form.min.js.map
