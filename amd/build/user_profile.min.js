/**
 * Controls the message preference page.
 *
 * @module     local_booking/administration
 * @author     Mustafa Hajjar (mustafahajjar@gmail.com)
 * @copyright  BAVirtual.co.uk Â© 2021
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_booking/user_profile",["jquery","core/str","core/notification","local_booking/repository","local_booking/selectors"],(function($,Str,Notification,Repository,Selectors){var processUserPreference=function(preference,value,courseId,userId,element){return Repository.updateUserPreferences(preference,value,courseId,userId).then().always((function(){Notification.fetchNotifications()})).fail((function(ex){Notification.exception(ex),$("#"+element).prop("checked",!$("#"+element).prop("checked"))}))},processSetting=function(courseId,userId,key,value,root){switch(startLoading($("#"+key+"-region")),key){case"endorse":!function(courseId,userId,endorse,root){var userProfile=root.find(Selectors.userprofilewrapper),endorsername=userProfile.data("endorsername"),endorser=userProfile.data("endorser"),endorsedate=new Date,endorsedon=endorsedate.toDateString(),endorsedatets=Math.round(endorsedate.getTime()/1e3),endorsestr=endorse?"endorsementmgs":"skilltestendorse";Str.get_string(endorsestr,"local_booking",{endorser:endorsername,endorsedate:endorsedon}).then(function(message){return $("#endorsement-label").html(message),endorse?$("#endorsement-letter").removeClass("hidden"):$("#endorsement-letter").addClass("hidden"),message}.bind(this)).fail(Notification.exception),processUserPreference("endorse",endorse,courseId,userId,"endorse"),processUserPreference("endorser",endorse?endorser:"",courseId,userId,"endorse"),processUserPreference("endorsedate",endorse?endorsedatets:"",courseId,userId,"endorse"),processUserPreference("endorsenotify",endorse,courseId,userId,"endorse")}(courseId,userId,value,root);break;case"availabilityoverride":processUserPreference(key,value,courseId,userId,key);break;case"suspend":!function(suspend,courseId,userId){Repository.updateSuspendedStatus(suspend,courseId,userId).then().always((function(){Notification.fetchNotifications()})).fail((function(ex){Notification.exception(ex),$("#suspended").prop("checked",!$("#suspended").prop("checked"))}))}(value,courseId,userId);break;case"onhold":case"keepactive":!function(key,value,courseId,userId,root){var group=root.find(Selectors.userprofilewrapper).data(key+"group");Repository.updateGroup(group,value,courseId,userId).then().always((function(){Notification.fetchNotifications()})).fail((function(ex){Notification.exception(ex),$("#"+key).prop("checked",!$("#"+key).prop("checked"))}))}(key,value,courseId,userId,root)}stopLoading($("#"+key+"-region"))},registerEventListeners=function(root){var userProfile=root.find(Selectors.userprofilewrapper),courseId=userProfile.data("courseid"),userId=userProfile.data("userid");$("#endorse").click((function(){processSetting(courseId,userId,"endorse",this.checked,root)})),$("#suspended").click((function(){processSetting(courseId,userId,"suspend",this.checked)})),$("#onhold").click((function(){processSetting(courseId,userId,"onhold",this.checked,root)})),$("#keepactive").click((function(){processSetting(courseId,userId,"keepactive",this.checked,root)})),$("#availabilityoverride").click((function(){processSetting(courseId,userId,"availabilityoverride",this.checked,root)})),$("#save_comment_button").click((function(){!function(courseId,userId,root){startLoading(root);var comment=$("#comment").val();Repository.updateProfileComment(courseId,userId,comment).then((function(response){var result=response.result;Str.get_string(result?"commentsaved":"commentnotsaved","local_booking").then((function(string){$("#status").addClass("comment-status-"+(result?"success":"error")),$("#status").removeClass("comment-status-"+(result?"error":"success")),$("#status").text(string).slideDown(1e3).delay(2e3).slideUp(1e3)})).fail(Notification.exception)})).always((function(){Notification.fetchNotifications(),stopLoading(root)})).fail(Notification.exception)}(courseId,userId,root)}))},startLoading=function(root){root.find(Selectors.containers.loadingIcon).removeClass("hidden")},stopLoading=function(root){root.find(Selectors.containers.loadingIcon).addClass("hidden")};return{init:function(root){root=$(root),registerEventListeners(root)}}}));

//# sourceMappingURL=user_profile.min.js.map