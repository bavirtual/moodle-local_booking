define ("local_booking/booking",["jquery","core/str","core/modal_factory","core/modal_events","core/pending","local_booking/modal_logentry_form","local_booking/view_manager","local_booking/booking_actions","local_booking/events","local_booking/selectors"],function(a,b,c,d,f,g,h,i,j,k){var l={PROGRESSION_WRAPPER:".progressionwrapper",CANCEL_BUTTON:"[data-region='cancel-button']",SESSION_ENTRY:"[data-region='session-entry']"},m=function(b,c){var d=a("body");d.on(j.canceled,function(){h.refreshProgressionContent(b);h.refreshMyBookingsContent(b)});d.on(j.created,function(){h.refreshProgressionContent(b)});d.on(j.updated,function(){h.refreshProgressionContent(b)});d.on(j.deleted,function(){h.refreshProgressionContent(b)});if("undefined"!==c){i.registerEditListeners(b,c)}},n=function(b){var d=c.create({type:g.TYPE,large:!0});b.on("click",k.actions.edit,function(b){b.preventDefault();var c=a(b.currentTarget),e=c.closest(k.progressionwrapper),f=c.closest(k.logentryItem);d.then(function(a){a.setSessionDate(f.data("sessionDate"));a.setLogentryId(f.data("logentryId"));a.setStudentId(f.data("studentId"));a.setCourseId(e.data("courseId"));a.setContextId(e.data("contextId"));a.show();b.stopImmediatePropagation()}).fail(Notification.exception)});return d},o=function(c){var d=n(c),e=a(l.PROGRESSION_WRAPPER).data("context-id"),g=a(l.PROGRESSION_WRAPPER).data("courseid");m(c,d);if(e){c.on("click",l.SESSION_ENTRY,function(b){var c=a(this).attr("data-session-date"),i=a(this).attr("data-student-id"),j=a(this).attr("data-exercise-id"),l=a(this).attr("data-logentry-id");if(0==l){d.then(function(a){a.setContextId(e);a.setCourseId(g);a.setStudentId(i);a.setExerciseId(j);a.setLogentryId(l);a.setSessionDate(c);a.show()}).fail(Notification.exception);b.preventDefault()}else{var m=null,n=null,o=b.target,p=new f("local_booking/view_manager:logentrySession:click");if(o.matches(k.actions.viewEvent)){m=o}else{m=o.closest(k.actions.viewEvent)}if(m){n=m.dataset.logentryId}else{n=o.querySelector(k.actions.viewEvent).dataset.logentryId}if(n){b.preventDefault();b.stopPropagation();h.renderLogentrySummaryModal(n,g,i).then(p.resolve).catch()}else{p.resolve()}}})}c.on("click",l.CANCEL_BUTTON,function(a){b.get_string("cancellationcomment","local_booking").then(function(b){var d=prompt(b);if(null!==d){i.cancelBooking(c,a,d)}}).catch(Notification.exception)})};return{init:function init(b){b=a(b);o(b);n(b)}}});
//# sourceMappingURL=booking.min.js.map
