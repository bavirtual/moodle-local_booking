function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_booking/calendar_view_manager",["exports","jquery","core/templates","core/notification","core/custom_interaction_events","local_booking/slot_actions","local_booking/repository","local_booking/selectors"],(function(_exports,_jquery,_templates,_notification,_custom_interaction_events,_slot_actions,Repository,Selectors){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handler booking view changes.
   * Improvised from core_calendar.
   *
   * @module     local_booking/calendar_view_manager
   * @author     Mustafa Hajjar (mustafahajjar@gmail.com)
   * @copyright  BAVirtual.co.uk Â© 2021
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.stopLoading=_exports.startLoading=_exports.reloadCurrentMonth=_exports.refreshWeekContent=_exports.init=_exports.changeWeek=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events),_slot_actions=_interopRequireDefault(_slot_actions),Repository=_interopRequireWildcard(Repository),Selectors=_interopRequireWildcard(Selectors);var refreshWeekContent=function(root,year,week,time,courseId,categoryId){var target=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,template=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";startLoading(root),target=target||root.find(Selectors.calendarwrapper),template=template||root.attr("data-template"),M.util.js_pending([root.get("id"),year,week,courseId].join("-"));var action=target.data("action"),view=target.data("viewall")?"all":"user",studentId=target.data("student-id"),exerciseId=target.data("exercise-id");return time=0==time?Date.now()/1e3:time,Repository.getCalendarWeekData(year,week,time,courseId,categoryId,action,view,studentId,exerciseId).then((function(context){return context.viewingmonth=!0,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).always((function(){return M.util.js_complete([root.get("id"),year,week,courseId].join("-")),_slot_actions.default.setPasteState(root),_slot_actions.default.setSaveButtonState(root,action),stopLoading(root)})).fail(_notification.default.exception)};_exports.refreshWeekContent=refreshWeekContent;var changeWeek=function(root,url,year,week,time,courseId,categoryId){return refreshWeekContent(root,year,week,time,courseId,categoryId,null,"").then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args}))};_exports.changeWeek=changeWeek;_exports.reloadCurrentMonth=function(root){var courseId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,categoryId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,year=root.find(Selectors.calendarwrapper).data("year"),week=root.find(Selectors.calendarwrapper).data("week"),time=root.find(Selectors.calendarwrapper).data("time");return courseId=courseId||root.find(Selectors.calendarwrapper).data("courseid"),categoryId=categoryId||root.find(Selectors.calendarwrapper).data("categoryid"),refreshWeekContent(root,year,week,time,courseId,categoryId,null,"")};var startLoading=function(root){root.find(Selectors.containers.loadingIcon).removeClass("hidden"),(0,_jquery.default)(root).one("submit",(function(){(0,_jquery.default)(this).find('input[type="submit"]').attr("disabled","disabled")}))};_exports.startLoading=startLoading;var stopLoading=function(root){root.find(Selectors.containers.loadingIcon).addClass("hidden"),(0,_jquery.default)(root).one("submit",(function(){(0,_jquery.default)(this).find('input[type="submit"]').attr("enabled","enabled")}))};_exports.stopLoading=stopLoading;_exports.init=function(root,view){!function(root){(root=(0,_jquery.default)(root)).on("click",Selectors.links.navLink,(function(e){var wrapper=root.find(Selectors.calendarwrapper),courseId=wrapper.data("courseid"),categoryId=wrapper.data("categoryid"),link=e.currentTarget;changeWeek(root,link.href,link.dataset.year,link.dataset.week,link.dataset.time,courseId,categoryId),e.preventDefault()}));var viewSelector=root.find(Selectors.viewSelector);_custom_interaction_events.default.define(viewSelector,[_custom_interaction_events.default.events.activate]),viewSelector.on(_custom_interaction_events.default.events.activate,(function(e){e.preventDefault();var option=e.target;if(!option.classList.contains("active")){var year=option.dataset.year,week=option.dataset.week,time=option.dataset.time,courseId=option.dataset.courseid,categoryId=option.dataset.categoryid;refreshWeekContent(root,year,week,time,courseId,categoryId,e.target,"local_booking/availability_calendar").then((function(){return window.history.pushState({},"","?view=user")})).fail(_notification.default.exception)}}))}(root)}}));

//# sourceMappingURL=calendar_view_manager.min.js.map