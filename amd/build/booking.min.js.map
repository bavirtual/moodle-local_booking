{"version":3,"sources":["../src/booking.js"],"names":["define","$","Str","ViewManager","BookingActions","Logentry","BookingSessions","SELECTORS","CANCEL_BUTTON","OVERRIDE_BUTTON","registerBookingEventListeners","root","body","on","canceled","refreshInstructorDashboardContent","refreshMyBookingsContent","created","updated","deleted","registerEventListeners","e","get_string","then","promptMsg","comment","prompt","cancelBooking","catch","Notification","exception","overrideRestriction","init"],"mappings":"AAyBAA,OAAM,yBAAC,CACC,QADD,CAEC,UAFD,CAGC,oCAHD,CAIC,+BAJD,CAKC,wBALD,CAMC,sBAND,CAAD,CAQF,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOE,IAEIC,CAAAA,CAAS,CAAG,CACdC,aAAa,CAAE,+BADD,CAEdC,eAAe,CAAE,iCAFH,CAFhB,CAgBKC,CAA6B,CAAG,SAASC,CAAT,CAAe,CAClD,GAAMC,CAAAA,CAAI,CAAGX,CAAC,CAAC,MAAD,CAAd,CAEAW,CAAI,CAACC,EAAL,CAAQP,CAAe,CAACQ,QAAxB,CAAkC,UAAW,CACzCX,CAAW,CAACY,iCAAZ,CAA8CJ,CAA9C,EACAR,CAAW,CAACa,wBAAZ,CAAqCL,CAArC,CACH,CAHD,EAIAC,CAAI,CAACC,EAAL,CAAQP,CAAe,CAACW,OAAxB,CAAiC,UAAW,CACxCd,CAAW,CAACY,iCAAZ,CAA8CJ,CAA9C,CACH,CAFD,EAGAC,CAAI,CAACC,EAAL,CAAQP,CAAe,CAACY,OAAxB,CAAiC,UAAW,CACxCf,CAAW,CAACY,iCAAZ,CAA8CJ,CAA9C,CACH,CAFD,EAGAC,CAAI,CAACC,EAAL,CAAQP,CAAe,CAACa,OAAxB,CAAiC,UAAW,CACxChB,CAAW,CAACY,iCAAZ,CAA8CJ,CAA9C,CACH,CAFD,CAGH,CAhCC,CA0CKS,CAAsB,CAAG,SAAST,CAAT,CAAe,CAG3CD,CAA6B,CAACC,CAAD,CAA7B,CAGAA,CAAI,CAACE,EAAL,CAAQ,OAAR,CAAiBN,CAAS,CAACC,aAA3B,CAA0C,SAASa,CAAT,CAAY,CAElDnB,CAAG,CAACoB,UAAJ,CAAe,qBAAf,CAAsC,eAAtC,EAAuDC,IAAvD,CAA4D,SAASC,CAAT,CAAoB,CAC5E,GAAMC,CAAAA,CAAO,CAAGC,MAAM,CAACF,CAAD,CAAtB,CACA,GAAgB,IAAZ,GAAAC,CAAJ,CAAsB,CAClBrB,CAAc,CAACuB,aAAf,CAA6BhB,CAA7B,CAAmCU,CAAnC,CAAsCI,CAAtC,CACH,CAEJ,CAND,EAMGG,KANH,CAMSC,YAAY,CAACC,SANtB,CAOH,CATD,EAYAnB,CAAI,CAACE,EAAL,CAAQ,OAAR,CAAiBN,CAAS,CAACE,eAA3B,CAA4C,UAAW,CACnD,MAAOL,CAAAA,CAAc,CAAC2B,mBAAf,CAAmCpB,CAAnC,CACV,CAFD,CAGH,CA/DC,CAiEF,MAAO,CACHqB,IAAI,CAAE,cAASrB,CAAT,CAAe,CACjBA,CAAI,CAAGV,CAAC,CAACU,CAAD,CAAR,CACAN,CAAQ,CAAC2B,IAAT,CAAcrB,CAAd,EACAS,CAAsB,CAACT,CAAD,CACzB,CALE,CAOV,CAvFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is responsible for registering listeners\n * for all session booking and logentry events.\n *\n * @module     local_booking/booking\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/str',\n        'local_booking/booking_view_manager',\n        'local_booking/booking_actions',\n        'local_booking/logentry',\n        'local_booking/events'\n    ],\n    function(\n        $,\n        Str,\n        ViewManager,\n        BookingActions,\n        Logentry,\n        BookingSessions\n    ) {\n\n    const SELECTORS = {\n        CANCEL_BUTTON: \"[data-region='cancel-button']\",\n        OVERRIDE_BUTTON: \"[data-region='override-button']\",\n    };\n\n    /**\n     * Listen to and handle any logentry events fired by\n     * Logentry and PIREP the modal forms.\n     *\n     * @method registerBookingEventListeners\n     * @param  {object} root The booking root element\n     * @param  {object} logentryFormModalPromise A promise reolved with the Logentry form modal\n     * @param  {object} pirepFormPromise A promise reolved with the PIREP verification form modal\n     */\n     const registerBookingEventListeners = function(root) {\n        const body = $('body');\n\n        body.on(BookingSessions.canceled, function() {\n            ViewManager.refreshInstructorDashboardContent(root);\n            ViewManager.refreshMyBookingsContent(root);\n        });\n        body.on(BookingSessions.created, function() {\n            ViewManager.refreshInstructorDashboardContent(root);\n        });\n        body.on(BookingSessions.updated, function() {\n            ViewManager.refreshInstructorDashboardContent(root);\n        });\n        body.on(BookingSessions.deleted, function() {\n            ViewManager.refreshInstructorDashboardContent(root);\n        });\n    };\n\n    /**\n     * Register event listeners for logbook entry,\n     * session cancellation, and restriction override actions\n     * in both 'Instructor dashboard' and 'Session selection' pages.\n     *\n     * @method  registerEventListeners\n     * @param   {object} root The booking root element\n     */\n     const registerEventListeners = function(root) {\n\n        // Register listeners to booking actions\n        registerBookingEventListeners(root);\n\n        // Listen to the click on the Cancel booking buttons in 'Instructor dashboard' page.\n        root.on('click', SELECTORS.CANCEL_BUTTON, function(e) {\n            // eslint-disable-next-line no-alert\n            Str.get_string('cancellationcomment', 'local_booking').then(function(promptMsg) {\n                const comment = prompt(promptMsg);\n                if (comment !== null) {\n                    BookingActions.cancelBooking(root, e, comment);\n                }\n                return;\n            }).catch(Notification.exception);\n        });\n\n        // Listen to the click on the Override button in the 'Session selection' page.\n        root.on('click', SELECTORS.OVERRIDE_BUTTON, function() {\n            return BookingActions.overrideRestriction(root);\n        });\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n            Logentry.init(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"booking.min.js"}