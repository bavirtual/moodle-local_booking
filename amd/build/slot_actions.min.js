define ("local_booking/slot_actions",["jquery","core/notification","local_booking/repository","local_booking/view_manager"],function(a,b,c,d){var j={CALENDAR_WRAPPER:"[class=calendarwrapper]",SLOTS_TABLE:"[data-region=\"slots-week\"]",SLOT_DAY:"[data-region=\"day\"]",SAVE_BUTTON:"[data-action=\"save\"]",PASTE_BUTTON:"[data-region='paste-button']",BOOK_BUTTON:"[data-region='book-button']",LOADING_ICON_CONTAINER:"[data-region=\"loading-icon-container\"]",VIEW_DAY_LINK:"[data-action='view-day-link']"},k=[],l,m=[];function e(a){d.startLoading(a);var e=a.find(j.CALENDAR_WRAPPER).data("courseid"),g=a.find(j.CALENDAR_WRAPPER).data("exercise-id"),h=a.find(j.CALENDAR_WRAPPER).data("student-id");f(a,"book");return c.saveBookedSlot(l,g,h).then(function(a){if(a.validationerror){alert("Errors encountered: Unable to save slot!")}}.bind(this)).always(function(){d.stopLoading(a);location.href=M.cfg.wwwroot+"/local/booking/view.php?courseid="+e}.bind(this)).fail(b.exception)}function f(b,c){var d="book"==c?"slot-booked":"slot-marked",e=b.find(j.CALENDAR_WRAPPER).data("year"),f=b.find(j.CALENDAR_WRAPPER).data("week"),g=b.find(j.SLOTS_TABLE).attr("id"),h=a("#"+g+" th"),m=document.getElementById(g).rows[0].cells.length,n;k.length=0;h.each(function(){if("slot-week-day"==a(this).data("region")){n=h.index(this)+1;return!1}});for(var o=function(b){var c=a("#"+g+" td:nth-child("+b+")").map(function(){return[[a(this).data(d),a(this).data("slot-timestamp")]]}).get(),h={};c.forEach(function(a){if(a[0]){if(0===Object.keys(h).length&&h.constructor===Object){h.starttime=a[1]}else{h.endtime=a[1]}}else if(!(0===Object.keys(h).length&&h.constructor===Object)){if("slot-marked"==d){k.push(h)}else if("slot-booked"==d){h.week=f;h.year=e;l=h;return}h={}}})},p=n;p<=m;p++){o(p)}}function g(a){if(0<m.length){a.find(j.PASTE_BUTTON).addClass("slot-button-blue").removeClass("slot-button-gray")}else{a.find(j.PASTE_BUTTON).addClass("slot-button-gray").removeClass("slot-button-blue")}}function h(a,b){f(a,b);if(l!==void 0){a.find(j.BOOK_BUTTON).addClass("slot-button-blue").removeClass("slot-button-gray")}else{a.find(j.BOOK_BUTTON).addClass("slot-button-gray").removeClass("slot-button-blue")}}return{saveWeekSlots:function(a){d.startLoading(a);var e=a.find(j.CALENDAR_WRAPPER).data("courseid"),g=a.find(j.CALENDAR_WRAPPER).data("year"),h=a.find(j.CALENDAR_WRAPPER).data("week");f(a);return c.saveSlots(k,e,g,h).then(function(a){if(a.validationerror){alert("Errors encountered: Unable to save slot!")}}.bind(this)).always(function(){b.fetchNotifications();return d.stopLoading(a)}.bind(this)).fail(b.exception)},saveBookedSlot:e,clearWeekSlots:function(){a("td").filter(function(){if(0==a(this).data("slot-booked")){a(this).data("slot-marked",0);a(this).removeClass("slot-selected")}})},pasteSlots:function(b){var c=document.getElementById(b.find(j.SLOTS_TABLE).attr("id"));m.forEach(function(b){var d=c.rows[b[0]].cells[b[1]];a(d).data("slot-marked",1);a(d).addClass("slot-selected",1)})},setPasteState:g,setBookState:h,copySlots:function(b){m.length=0;a(j.SLOT_DAY).each(function(b,c){if(a(c).data("slot-marked")){m.push([c.closest("tr").rowIndex,c.cellIndex])}});g(b)},setSlot:function(b,c,d){var e="book"==d?"slot-booked":"slot-marked",f="book"==d?"slot-booked":"slot-selected";if(!a(b).data(e)){a(b).addClass(f)}else{a(b).removeClass(f)}a(b).data(e,!a(b).data(e))},Slots:k,SlotIndexes:m}});
//# sourceMappingURL=slot_actions.min.js.map
