{"version":3,"sources":["../src/view_manager.js"],"names":["registerEventListeners","root","on","BookingsSelectors","links","logentryLink","e","target","logentryId","courseId","studentId","pendingPromise","Pending","matches","actions","viewEvent","closest","dataset","querySelector","preventDefault","stopPropagation","renderLogentrySummaryModal","then","resolve","catch","navLink","wrapper","find","calendarwrapper","data","categoryId","link","currentTarget","changeWeek","href","year","week","time","viewSelector","CustomEvents","define","events","activate","option","classList","contains","courseid","categoryid","refreshWeekContent","window","history","pushState","fail","Notification","exception","template","startLoading","attr","M","util","js_pending","get","join","action","view","exerciseId","Date","now","Repository","getCalendarWeekData","context","viewingmonth","Templates","render","html","js","replaceNode","always","js_complete","SlotActions","setPasteState","setBookState","stopLoading","url","length","args","reloadCurrentMonth","refreshProgressionContent","progressionwrapper","getBookingsData","viewingbooking","refreshMyBookingsContent","mybookingswrapper","getLogentryById","getEventResponse","logentry","Error","logentryData","modalParams","title","Str","get_string","type","SummaryModal","TYPE","body","templateContext","canedit","candelete","isactionevent","ModalFactory","create","modal","getRoot","ModalEvents","hidden","destroy","show","loadingIconContainer","containers","loadingIcon","removeClass","one","addClass","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler booking view changes.\n * Improvised from core_calendar.\n *\n * @module     local_booking/view_manager\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk © 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as Str from 'core/str';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport CustomEvents from 'core/custom_interaction_events';\nimport SlotActions from 'local_booking/slot_actions';\nimport SummaryModal from 'local_booking/modal_logentry_summary';\nimport * as Repository from 'local_booking/repository';\nimport * as BookingsSelectors from 'local_booking/selectors';\n\n/**\n * Register event listeners for the module.\n *\n * @param {object} root The root element.\n */\n const registerEventListeners = (root) => {\n    root = $(root);\n\n    // Bind click events to logentry exercise session.\n    root.on('click', BookingsSelectors.links.logentryLink, (e) => {\n        const target = e.target;\n        let logentryLink = null;\n        let logentryId = null;\n        let courseId = null;\n        let studentId = null;\n        const pendingPromise = new Pending('local_booking/view_manager:logentryLink:click');\n\n        if (target.matches(BookingsSelectors.actions.viewEvent)) {\n            logentryLink = target;\n        } else {\n            logentryLink = target.closest(BookingsSelectors.actions.viewEvent);\n        }\n\n        if (logentryLink) {\n            logentryId = logentryLink.dataset.logentryId;\n            courseId = logentryLink.dataset.courseId;\n            studentId = logentryLink.dataset.studentId;\n        } else {\n            logentryId = target.querySelector(BookingsSelectors.actions.viewEvent).dataset.logentryId;\n            courseId = target.querySelector(BookingsSelectors.actions.viewEvent).dataset.courseId;\n            studentId = target.querySelector(BookingsSelectors.actions.viewEvent).dataset.studentId;\n        }\n\n        if (logentryId) {\n            // A link was found. Show the modal.\n\n            e.preventDefault();\n            // We've handled the event so stop it from bubbling\n            // and causing the day click handler to fire.\n            e.stopPropagation();\n\n            renderLogentrySummaryModal(logentryId, courseId, studentId)\n            .then(pendingPromise.resolve)\n            .catch();\n        } else {\n            pendingPromise.resolve();\n        }\n    });\n\n    root.on('click', BookingsSelectors.links.navLink, (e) => {\n        const wrapper = root.find(BookingsSelectors.calendarwrapper);\n        const courseId = wrapper.data('courseid');\n        const categoryId = wrapper.data('categoryid');\n        const link = e.currentTarget;\n\n        changeWeek(root, link.href, link.dataset.year, link.dataset.week, link.dataset.time, courseId, categoryId);\n        e.preventDefault();\n    });\n\n    const viewSelector = root.find(BookingsSelectors.viewSelector);\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n    viewSelector.on(\n        CustomEvents.events.activate,\n        (e) => {\n            e.preventDefault();\n\n            const option = e.target;\n            if (option.classList.contains('active')) {\n                return;\n            }\n\n            const year = option.dataset.year,\n                week = option.dataset.week,\n                time = option.dataset.time,\n                courseId = option.dataset.courseid,\n                categoryId = option.dataset.categoryid;\n\n            refreshWeekContent(root, year, week, time, courseId, categoryId, root, 'local_booking/calendar_week')\n                .then(() => {\n                    return window.history.pushState({}, '', '?view=user');\n                }).fail(Notification.exception);\n        }\n    );\n};\n\n/**\n * Refresh the week content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} week week\n * @param {number} time The timestamp of the begining current week\n * @param {number} courseId The id of the course associated with the calendar shown\n * @param {number} categoryId The id of the category associated with the calendar shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\n export const refreshWeekContent = (root, year, week, time, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelectors.calendarwrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, week, courseId].join('-'));\n\n    const action = target.data('action');\n    const view = target.data('viewall') ? 'all' : 'user';\n    const studentId = target.data('student-id');\n    const exerciseId = target.data('exercise-id');\n    time = time == 0 ? Date.now() / 1000 : time;\n\n    return Repository.getCalendarWeekData(year, week, time, courseId, categoryId, action, view, studentId, exerciseId)\n        .then(context => {\n            context.viewingmonth = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, week, courseId].join('-'));\n            SlotActions.setPasteState(root);\n            SlotActions.setBookState(root, action);\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The container element\n * @param {string} url The calendar url to be shown\n * @param {number} year Year\n * @param {number} week week\n * @param {number} time The timestamp of the begining current week\n * @param {number} courseId The id of the course associated with the calendar shown\n * @param {number} categoryId The id of the category associated with the calendar shown\n * @return {promise}\n */\nexport const changeWeek = (root, url, year, week, time, courseId, categoryId) => {\n    return refreshWeekContent(root, year, week, time, courseId, categoryId, null, '')\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                window.history.pushState({}, '', url);\n            }\n            return args;\n        });\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The id of the course associated with the calendar shown\n * @param {number} categoryId The id of the category associated with the calendar shown\n * @return {promise}\n */\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\n    const year = root.find(BookingsSelectors.calendarwrapper).data('year');\n    const week = root.find(BookingsSelectors.calendarwrapper).data('week');\n    const time = root.find(BookingsSelectors.calendarwrapper).data('time');\n\n    courseId = courseId || root.find(BookingsSelectors.calendarwrapper).data('courseid');\n    categoryId = categoryId || root.find(BookingsSelectors.calendarwrapper).data('categoryid');\n\n    return refreshWeekContent(root, year, week, time, courseId, categoryId, null, '');\n};\n\n/**\n * Refresh student progression content.\n *\n * @param {object} root The root element.\n * @param {number} courseId The id of the course associated with the progression view shown\n * @param {number} categoryId The id of the category associated with the progression view shown\n * @param {object} target The element being replaced. If not specified, the bookingwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const refreshProgressionContent = (root, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelectors.progressionwrapper);\n    courseId = courseId || root.find(BookingsSelectors.progressionwrapper).data('courseid');\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), courseId, categoryId].join('-'));\n    return Repository.getBookingsData(courseId, categoryId)\n        .then((context) => {\n            context.viewingbooking = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n\n/**\n * Refresh my bookings content.\n *\n * @param {object} root The root element.\n * @param {number} courseId The id of the course associated with the progression view shown\n * @param {number} categoryId The id of the category associated with the progression view shown\n * @param {object} target The element being replaced. If not specified, the bookingwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\n export const refreshMyBookingsContent = (root, courseId) => {\n    startLoading(root);\n\n    const target = root.find(BookingsSelectors.mybookingswrapper);\n    courseId = courseId || root.find(BookingsSelectors.progressionwrapper).data('courseid');\n    M.util.js_pending([root.get('id'), courseId].join('-'));\n    return Repository.getBookingsData(courseId)\n        .then((context) => {\n            context.viewingbooking = true;\n            return Templates.render('local_booking/my_bookings', context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), courseId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Render the logentry summary modal.\n *\n * @param {Number} logentryId The graded session logbook entry id.\n * @param {Number} courseId The graded session course id.\n * @param {Number} studentId The graded session student id.\n * @returns {Promise}\n */\n export const renderLogentrySummaryModal = (logentryId, courseId, studentId) => {\n    const pendingPromise = new Pending('local_booking/view_manager:renderLogentrySummaryModal');\n\n    // Calendar repository promise.\n    return Repository.getLogentryById(logentryId, courseId, studentId)\n    .then((getEventResponse) => {\n        if (!getEventResponse.logentry) {\n            throw new Error('Error encountered while trying to fetch logbook entry with ID: ' + logentryId);\n        }\n\n        return getEventResponse.logentry;\n    })\n    .then(logentryData => {\n        // Build the modal parameters from the logentry data.\n        const modalParams = {\n            title: Str.get_string('logentry', 'local_booking'),\n            type: SummaryModal.TYPE,\n            body: Templates.render('local_booking/logentry_summary_body', logentryData),\n            templateContext: {\n                canedit: logentryData.canedit,\n                candelete: logentryData.candelete,\n                isactionevent: logentryData.isactionevent,\n                url: logentryData.url,\n                action: logentryData.action\n            }\n        };\n\n        // Create the modal.\n        return ModalFactory.create(modalParams);\n    })\n    .then(modal => {\n        // Handle hidden event.\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            // Destroy when hidden.\n            modal.destroy();\n        });\n\n        // Finally, render the modal!\n        modal.show();\n\n        return modal;\n    })\n    .then(modal => {\n        pendingPromise.resolve();\n\n        return modal;\n    })\n    .catch(Notification.exception);\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\n export const startLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelectors.containers.loadingIcon);\n    loadingIconContainer.removeClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('disabled', 'disabled');\n    });\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nexport const stopLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelectors.containers.loadingIcon);\n    loadingIconContainer.addClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('enabled', 'enabled');\n    });\n};\n\nexport const init = (root, view) => {\n    registerEventListeners(root, view);\n};"],"file":"view_manager.min.js"}