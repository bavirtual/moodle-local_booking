define ("local_booking/booking_actions",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core/pending","local_booking/modal_logentry_form","local_booking/repository","local_booking/events","local_booking/modal_delete","local_booking/selectors","local_booking/booking_view_manager"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(d,e,f){var j=new i("local_booking/booking_actions:confirmDeletion"),m=[{key:"deletelogentry",component:"local_booking"}],n;m.push({key:"confirmlogentrydelete",component:"local_booking"});n=g.create({type:g.types.SAVE_CANCEL});var o=b.get_strings(m),p=a.when(o,n).then(function(b,g){g.setRemoveOnClose(!0);g.setTitle(b[0]);g.setBody(b[1]);g.setSaveButtonText(b[0]);g.show();g.getRoot().on(h.save,function(){var b=new i("local_booking/booking_actions:initModal:deletedlogentry");k.deleteLogentry(d,e,f).then(function(){a("body").trigger(l.deleted,[d,!1])}).then(b.resolve).catch(c.exception)});return g}).then(function(a){j.resolve();return a}).catch(c.exception);return p}return{registerRedirect:function(b){b.on("click",n.actions.gotoFeedback,function(c){var d=b.find(n.logentryItem),e=d.data("exerciseId"),f=d.data("studentId");a("body").trigger(l.gotoFeedback,[e]);location.href=M.cfg.wwwroot+"/mod/assign/view.php?id="+e+"&rownum=0&userid="+f+"&action=grader";c.preventDefault()})},registerDelete:function(a){a.on("click",n.actions.deleteLogentry,function(b){var c=a.find(n.logentryItem),d=c.data("logentryId"),e=c.data("studentId"),f=c.data("courseId");p(d,e,f);b.preventDefault()})},registerEditListeners:function(b,d){var e=new i("local_booking/booking_actions:registerEditListeners");return d.then(function(c){a("body").on(l.editLogentry,function(a,d,e,f){var g=b.find(n.progressionwrapper);c.setLogentryId(f);c.setLogentryId(d);c.setStudentId(e);c.setCourseId(g.data("courseid"));c.setContextId(g.data("contextId"));c.show();a.stopImmediatePropagation()});return c}).then(function(a){e.resolve();return a}).catch(c.exception)},cancelBooking:function cancelBooking(d,f,e){o.startLoading(d);var g=f.target,h=h||d.find(n.progressionwrapper).data("courseid"),i=g.dataset.bookingid;return k.cancelBooking(i,e).then(function(a){if(a.validationerror){alert(b.get_string("errorlogentrycancel","local_booking"))}}).always(function(){a("body").trigger(l.canceled,[d,!1]);c.fetchNotifications();o.stopLoading(d)}).fail(c.exception)}}});
//# sourceMappingURL=booking_actions.min.js.map
