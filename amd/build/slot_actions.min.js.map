{"version":3,"sources":["../src/slot_actions.js"],"names":["define","$","Notification","Repository","CalendarViewManager","SELECTORS","CALENDAR_WRAPPER","SLOTS_TABLE","SLOT_DAY","SAVE_BUTTON","PASTE_BUTTON","BOOK_BUTTON","DAY_TIME_SLOT","LOADING_ICON_CONTAINER","Slots","BookedSlot","SlotIndexes","postActive","saveBookedSlot","root","startLoading","course","find","data","exercise","studentid","getUISlots","then","response","validationerror","alert","location","href","M","cfg","wwwroot","bind","always","stopLoading","fail","exception","action","slottype","year","week","tableid","attr","head","colCount","document","getElementById","rows","cells","length","colOffset","each","index","i","dayHour","map","get","aSlot","forEach","hourSlot","isLastElement","Object","keys","constructor","starttime","endtime","addSlot","push","setPasteState","addClass","removeClass","setSaveButtonState","forceenable","disabled","SaveButton","state","prop","setSlot","cell","slotaction","slotactionclass","postSlots","target","overridePost","is","saveWeekSlots","serverCall","saveSlots","clearSlots","fetchNotifications","clearWeekSlots","filter","pasteSlots","table","idx","slot","copySlots","el","closest","rowIndex","cellIndex","setPosting"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for the quick add or update event modal.\n *\n * @module     local_booking/slot_actions\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk © 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/notification',\n    'local_booking/repository',\n    'local_booking/calendar_view_manager',\n    ],\n    function(\n        $,\n        Notification,\n        Repository,\n        CalendarViewManager\n    ) {\n\n    var SELECTORS = {\n        CALENDAR_WRAPPER: '[class=calendarwrapper]',\n        SLOTS_TABLE: '[data-region=\"slots-week\"]',\n        SLOT_DAY: '[data-region=\"day\"]',\n        SAVE_BUTTON: '[data-region=\"save-button\"]',\n        PASTE_BUTTON: \"[data-region='paste-button']\",\n        BOOK_BUTTON: \"[data-region='book-button']\",\n        DAY_TIME_SLOT: \"[data-action='day-time-slot']\",\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\n    };\n\n    var Slots = [];\n    var BookedSlot;\n    var SlotIndexes = [];\n    var postActive = false;\n\n    /**\n     * Save marked availability posts.\n     *\n     * @method saveWeekSlots\n     * @param {object} root The calendar root element\n     * @return {object} The create modal promise\n     */\n    function saveWeekSlots(root) {\n\n        CalendarViewManager.startLoading(root);\n\n        // Get year and week\n        const course = root.find(SELECTORS.CALENDAR_WRAPPER).data('courseid');\n        const year = root.find(SELECTORS.CALENDAR_WRAPPER).data('year');\n        const week = root.find(SELECTORS.CALENDAR_WRAPPER).data('week');\n\n        getUISlots(root);\n\n        let serverCall = null;\n        if (Slots.length != 0) {\n            serverCall = Repository.saveSlots(Slots, course, year, week);\n        } else {\n            serverCall = Repository.clearSlots(course, year, week);\n        }\n\n        // Send a request to the server to clear slots.\n        return serverCall\n            .then(function(response) {\n                if (response.validationerror) {\n                    // eslint-disable-next-line no-alert\n                    alert('Errors encountered: Unable to process availability posting action!');\n                }\n                return;\n            }\n            .bind(this))\n            .always(function() {\n                Notification.fetchNotifications();\n                return CalendarViewManager.stopLoading(root);\n            }\n            .bind(this))\n            .fail(Notification.exception);\n    }\n\n    /**\n     * Save marked booking posts.\n     *\n     * @method saveBookedSlot\n     * @param {object} root The calendar root element\n     * @return {object} The create modal promise\n     */\n    function saveBookedSlot(root) {\n\n        CalendarViewManager.startLoading(root);\n\n        // Get exercise id and the user id from the URL\n        const course = root.find(SELECTORS.CALENDAR_WRAPPER).data('courseid');\n        const exercise = root.find(SELECTORS.CALENDAR_WRAPPER).data('exercise-id');\n        const studentid = root.find(SELECTORS.CALENDAR_WRAPPER).data('student-id');\n\n        getUISlots(root, 'book');\n\n        // Send the form data to the server for processing.\n        return Repository.saveBookedSlot(BookedSlot, course, exercise, studentid)\n            .then(function(response) {\n                if (response.validationerror) {\n                    // eslint-disable-next-line no-alert\n                    alert('Errors encountered: Unable to save slot!');\n                } else {\n                    // Redirect to bookings view\n                    location.href = M.cfg.wwwroot + '/local/booking/view.php?courseid=' + course;\n                }\n                return;\n            }\n            .bind(this))\n            .always(function() {\n                CalendarViewManager.stopLoading(root);\n                return;\n            }\n            .bind(this))\n            .fail(Notification.exception);\n    }\n\n    /**\n     * Update Slots & BookedSlots with marked availability\n     * posts in the calendar view.\n     *\n     * @method getSlots\n     * @param {object} root     The calendar root element\n     * @param {String} action   The action for display view/book\n     */\n    function getUISlots(root, action) {\n\n        const slottype = action == 'book' ? 'slot-booked' : 'slot-marked';\n        const year = root.find(SELECTORS.CALENDAR_WRAPPER).data('year');\n        const week = root.find(SELECTORS.CALENDAR_WRAPPER).data('week');\n\n        const tableid = root.find(SELECTORS.SLOTS_TABLE).attr('id');\n        const head = $('#' + tableid + ' th');\n        const colCount = document.getElementById(tableid).rows[0].cells.length;\n        let colOffset;\n\n        Slots.length = 0;\n\n        // Get column index for the start of the week\n        head.each(function() {\n            if ($(this).data('region') == 'slot-week-day') {\n                colOffset = head.index(this) + 1;\n                return false;\n            }\n        });\n\n        // Get all slots for this week from the UI table\n        for (let i = colOffset; i <= colCount; i++) {\n            // Get slots for the current day\n            const dayHour = $('#' + tableid + ' td:nth-child(' + i + ')').map(function() {\n                return [[$(this).data(slottype), $(this).data('slot-timestamp')]];\n            }).get();\n\n            // Get each slot in the day (start and end times)\n            let aSlot = {};\n\n            // Check each day (column) and record marked slot start-end times\n            // eslint-disable-next-line no-loop-func\n            dayHour.forEach((hourSlot, index) => {\n                let isLastElement = index == dayHour.length - 1;\n                // Check if the slot is marked to record start or end time in marked sequence\n                if (hourSlot[0]) {\n                    if (Object.keys(aSlot).length === 0 && aSlot.constructor === Object) {\n                        aSlot.starttime = hourSlot[1];\n                    } else {\n                        aSlot.endtime = hourSlot[1];\n                    }\n                // Add the slot if it has start and end, and this slot is empty => slot sequence ended\n                } else if (!(Object.keys(aSlot).length === 0 && aSlot.constructor === Object)) {\n                    aSlot = addSlot(aSlot, slottype, week, year);\n                }\n                // Add slot if it ends at the end of the day\n                if (isLastElement && !(Object.keys(aSlot).length === 0 && aSlot.constructor === Object)) {\n                    aSlot = addSlot(aSlot, slottype, week, year);\n                }\n            });\n        }\n    }\n\n    /**\n     * Adds a slot to local object array (Slots).\n     *\n     * @method addSlot\n     * @param {object} aSlot The slot to be add to the local object array\n     * @param {string} slottype The slot type availability post vs booked\n     * @param {int} week The week of the year\n     * @param {int} year The year\n     * @return {object} empty object\n     */\n     function addSlot(aSlot, slottype, week = 0, year = 0) {\n        if (slottype == 'slot-marked') {\n            Slots.push(aSlot);\n        } else if (slottype == 'slot-booked') {\n            aSlot.week = week;\n            aSlot.year = year;\n            BookedSlot = aSlot;\n        }\n        return {};\n    }\n\n    /**\n     * Update the indexes array tracking copied table indexes\n     * editing existing events.\n     *\n     * @param {object} root The calendar root element\n     * @method copySlots\n     */\n    function copySlots(root) {\n        SlotIndexes.length = 0;\n\n        $(SELECTORS.SLOT_DAY).each((idx, el) => {\n            if ($(el).data('slot-marked')) {\n                SlotIndexes.push([el.closest('tr').rowIndex, el.cellIndex]);\n            }\n        });\n\n        setPasteState(root);\n\n        return;\n    }\n\n    /**\n     * Set the cells from the copied SlotIndexes\n     * to the calendar\n     *\n     * @method pasteSlots\n     * @param {object} root The calendar root element\n     */\n    function pasteSlots(root) {\n        const table = document.getElementById(root.find(SELECTORS.SLOTS_TABLE).attr('id'));\n        SlotIndexes.forEach((idx) => {\n            let slot = table.rows[idx[0]].cells[idx[1]];\n            $(slot).data('slot-marked', 1);\n            $(slot).addClass('slot-selected', 1);\n        });\n        setSaveButtonState(root, 'post');\n\n        return;\n     }\n\n    /**\n     * Clear slots for a user per course in week and year\n     * given they are not otherwsie booked\n     *\n     * @method clearWeekSlots\n     * @param {object} root The week calendar root element\n     */\n    function clearWeekSlots(root) {\n        $('td').filter(function() {\n            if ($(this).data('slot-booked') == 0) {\n                $(this).data('slot-marked', 0);\n                $(this).removeClass('slot-selected');\n            }\n        });\n        setSaveButtonState(root, 'post', true);\n\n        return;\n    }\n\n    /**\n     * Set the cells from the copied SlotIndexes to the current table\n     *\n     * @method setPasteState\n     * @param {object} root The week calendar root element\n     */\n    function setPasteState(root) {\n        if (SlotIndexes.length > 0) {\n            root.find(SELECTORS.PASTE_BUTTON).addClass('slot-button-blue').removeClass('slot-button-gray');\n        } else {\n            root.find(SELECTORS.PASTE_BUTTON).addClass('slot-button-gray').removeClass('slot-button-blue');\n        }\n\n        return;\n     }\n\n    /**\n     * Set the save buttons state to enabled/disabled based\n     * on user calendar time slot selection (cells) in\n     * the week calendar\n     *\n     * @method setSaveButtonState\n     * @param {object} root      The calendar root element\n     * @param {string} action    The action behind the view\n     * @param {bool} forceenable Enable save button\n     */\n    function setSaveButtonState(root, action, forceenable) {\n        getUISlots(root, action);\n\n        const enabled = 'slot-button-blue';\n        const disabled = 'slot-button-gray';\n        const SaveButton = root.find(action == 'book' ? SELECTORS.BOOK_BUTTON : SELECTORS.SAVE_BUTTON);\n\n        let state = forceenable ||\n                (action == 'book' && BookedSlot !== undefined && BookedSlot.length !== 0) ||\n                (action == 'post' && Slots !== undefined && Slots.length !== 0);\n\n        SaveButton.addClass(state ? enabled : disabled).removeClass(!state ? enabled : disabled);\n        SaveButton.prop('disabled', !state);\n\n        return;\n     }\n\n    /**\n     * Set the cells from the CopiedSlotsIndexes to the current table\n     *\n     * @method setSlot\n     * @param {object} cell     The target event to the clicked slot element\n     * @param {object} root     The calendar root element\n     * @param {String} action   The target event to the clicked slot element\n     */\n    function setSlot(cell, root, action) {\n        const slotaction = action == 'book' ? 'slot-booked' : 'slot-marked';\n        const slotactionclass = action == 'book' ? 'slot-booked' : 'slot-selected';\n\n        if (!$(cell).data(slotaction)) {\n            $(cell).addClass(slotactionclass);\n        } else {\n            $(cell).removeClass(slotactionclass);\n        }\n        $(cell).data(slotaction, !$(cell).data(slotaction));\n\n        return;\n    }\n\n    /**\n     * Set cells selected and save buttons state\n     *\n     * @method setPosting\n     * @param {bool} state  The posting state\n     */\n    function setPosting(state) {\n        postActive = state;\n    }\n\n    /**\n     * Set cells selected and save buttons state\n     *\n     * @method postSlot\n     * @param {object} root     The calendar root element\n     * @param {String} action   The action behind the active view\n     * @param {object} target   The target event object (cell)\n     * @param {String} overridePost The override flag for posting state\n     */\n    function postSlots(root, action, target, overridePost = false) {\n        // Change marked state\n        if (typeof target !== 'undefined' && (postActive || overridePost)) {\n            if (!target.is(SELECTORS.DAY_TIME_SLOT) && action !== 'all' && action !== '') {\n                setSlot(target, root, action);\n                setSaveButtonState(root, action);\n            }\n        }\n\n        return;\n    }\n\n    return {\n        saveWeekSlots: saveWeekSlots,\n        saveBookedSlot: saveBookedSlot,\n        clearWeekSlots: clearWeekSlots,\n        pasteSlots: pasteSlots,\n        setPasteState: setPasteState,\n        setSaveButtonState: setSaveButtonState,\n        copySlots: copySlots,\n        postSlots: postSlots,\n        setPosting: setPosting,\n        Slots: Slots,\n        SlotIndexes: SlotIndexes\n    };\n});"],"file":"slot_actions.min.js"}