/**
 * This module handles additional logentry modal form action.
 *
 * @module     local_booking/modal_actions
 * @author     Mustafa Hajjar (mustafa.hajjar)
 * @copyright  BAVirtual.co.uk Â© 2024
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_booking/modal_actions",["jquery","core/str","core/notification","core/modal_events","core/pending","local_booking/repository","local_booking/modal_delete","local_booking/modal_warning","local_booking/events","local_booking/selectors","local_booking/booking_actions"],(function($,Str,Notification,ModalEvents,Pending,Repository,ModalDelete,ModalWarning,BookingSessions,Selectors,BookingActions){return{registerDelete:root=>{root.on("click",Selectors.actions.deleteLogentry,(function(e){const target=e.target;let logentrySource=root.find(Selectors.logentryitem);((logentryId,userId,courseId,cascade)=>{let deletePromise,pendingPromise=new Pending("local_booking/booking_actions:confirmDeletion"),deleteStrings=[{key:"deletelogentry",component:"local_booking"}];deleteStrings.push({key:"confirmlogentrydelete",component:"local_booking"}),deletePromise=ModalDelete.create();let stringsPromise=Str.get_strings(deleteStrings);$.when(stringsPromise,deletePromise).then((function(strings,deleteModal){return deleteModal.setRemoveOnClose(!0),deleteModal.setTitle(strings[0]),deleteModal.setBody(strings[1]),deleteModal.show(),deleteModal.getRoot().on(ModalEvents.save,(function(){let pendingPromise=new Pending("local_booking/booking_actions:initModal:deletedlogentry");Repository.deleteLogentry(logentryId,userId,courseId,cascade).then((function(){$("body").trigger(BookingSessions.logentrydeleted,[logentryId,!1])})).then(pendingPromise.resolve).always((function(){Notification.fetchNotifications()})).catch(Notification.exception)})),deleteModal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)})(logentrySource.data("logentryId")||target.closest(Selectors.containers.summaryForm).dataset.logentryId,logentrySource.data("userId")||target.closest(Selectors.containers.summaryForm).dataset.userId,logentrySource.data("courseId")||$(Selectors.wrappers.logbookwrapper).data("courseid"),logentrySource.data("cascade")||target.closest(Selectors.containers.summaryForm).dataset.cascade),e.preventDefault()}))},registerRedirect:function(root){root.on("click",Selectors.actions.gotoFeedback,(function(e){BookingActions.gotoFeedback(root,e),e.preventDefault()}))},showWarning:function(message,title){var _title,_options$buttonType,_options$buttonDefaul;let data=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==(_title=title)&&void 0!==_title||(title="wanringtitle"),null!==(_options$buttonType=options.buttonType)&&void 0!==_options$buttonType||(options.buttonType="ok"),null!==(_options$buttonDefaul=options.buttonDefault)&&void 0!==_options$buttonDefaul||(options.buttonDefault="ok");let footer='<button type="button" class="btn btn-primary" data-action="ok">Ok</button>';"yesno"==options.buttonType&&(footer='<button type="button" class="btn '+("no"==options.buttonDefault?"btn-primary":"btn-secondary")+'" data-action="no">No</button>',footer+='<button type="button" class="btn '+("no"!=options.buttonDefault?"btn-primary":"btn-secondary")+'" data-action="yes">Yes</button>');let finalPromise,pendingPromise=new Pending("local_booking/booking_actions:showWarning"),warningPromise=ModalWarning.create();if(options.fromComponent){let warningStrings=[{key:title,component:"local_booking"}];message&&warningStrings.push({key:message,component:"local_booking",param:data});let stringsPromise=Str.get_strings(warningStrings).fail(Notification.exception);finalPromise=$.when(stringsPromise,warningPromise).then((function(strings,warningModal){return warningModal.setRemoveOnClose(!0),warningModal.setTitle(strings[0]),warningModal.setBody(strings[1]),warningModal.setData(data),warningModal.setFooter(footer),warningModal.show(),warningModal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception)}else finalPromise=$.when(warningPromise).then((function(warningModal){return warningModal.setRemoveOnClose(!0),warningModal.setTitle(title),warningModal.setBody(message),warningModal.setData(data),warningModal.setFooter(footer),warningModal.show(),warningModal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(Notification.exception);return finalPromise}}}));

//# sourceMappingURL=modal_actions.min.js.map