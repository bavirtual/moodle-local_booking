{"version":3,"sources":["../src/view_manager.js"],"names":["refreshBookingsContent","root","courseId","categoryId","target","template","startLoading","find","BookingsSelector","wrapper","attr","M","util","js_pending","get","join","Repository","getBookingsData","then","context","viewingbooking","Templates","render","html","js","replaceNode","always","js_complete","stopLoading","fail","Notification","exception","loadingIconContainer","containers","loadingIcon","removeClass","one","addClass"],"mappings":"wkBAuBA,OACA,OACA,OACA,OACA,O,ylBAYO,GAAMA,CAAAA,CAAsB,CAAG,SAACC,CAAD,CAAOC,CAAP,CAAiBC,CAAjB,CAA8D,IAAjCC,CAAAA,CAAiC,wDAAxB,IAAwB,CAAlBC,CAAkB,wDAAP,EAAO,CAChGC,CAAY,CAACL,CAAD,CAAZ,CAEAG,CAAM,CAAGA,CAAM,EAAIH,CAAI,CAACM,IAAL,CAAUC,CAAgB,CAACC,OAA3B,CAAnB,CACAJ,CAAQ,CAAGA,CAAQ,EAAIJ,CAAI,CAACS,IAAL,CAAU,eAAV,CAAvB,CACAC,CAAC,CAACC,IAAF,CAAOC,UAAP,CAAkB,CAACZ,CAAI,CAACa,GAAL,CAAS,IAAT,CAAD,CAAiBZ,CAAjB,CAA2BC,CAA3B,EAAuCY,IAAvC,CAA4C,GAA5C,CAAlB,EACA,MAAOC,CAAAA,CAAU,CAACC,eAAX,CAA2Bf,CAA3B,CAAqCC,CAArC,EACFe,IADE,CACG,SAAAC,CAAO,CAAI,CACbA,CAAO,CAACC,cAAR,IACA,MAAOC,WAAUC,MAAV,CAAiBjB,CAAjB,CAA2Bc,CAA3B,CACV,CAJE,EAKFD,IALE,CAKG,SAACK,CAAD,CAAOC,CAAP,CAAc,CAChB,MAAOH,WAAUI,WAAV,CAAsBrB,CAAtB,CAA8BmB,CAA9B,CAAoCC,CAApC,CACV,CAPE,EAQFE,MARE,CAQK,UAAM,CACVf,CAAC,CAACC,IAAF,CAAOe,WAAP,CAAmB,CAAC1B,CAAI,CAACa,GAAL,CAAS,IAAT,CAAD,CAAiBZ,CAAjB,CAA2BC,CAA3B,EAAuCY,IAAvC,CAA4C,GAA5C,CAAnB,EACA,MAAOa,CAAAA,CAAW,CAAC3B,CAAD,CACrB,CAXE,EAYF4B,IAZE,CAYGC,UAAaC,SAZhB,CAaV,CAnBM,C,2BA2BC,GAAMzB,CAAAA,CAAY,CAAG,SAACL,CAAD,CAAU,CACnC,GAAM+B,CAAAA,CAAoB,CAAG/B,CAAI,CAACM,IAAL,CAAUC,CAAgB,CAACyB,UAAjB,CAA4BC,WAAtC,CAA7B,CACAF,CAAoB,CAACG,WAArB,CAAiC,QAAjC,EAEA,cAAElC,CAAF,EAAQmC,GAAR,CAAY,QAAZ,CAAsB,UAAW,CAC7B,cAAE,IAAF,EAAQ7B,IAAR,CAAa,wBAAb,EAAqCG,IAArC,CAA0C,UAA1C,CAAsD,UAAtD,CACH,CAFD,CAGH,CAPO,C,iBAeD,GAAMkB,CAAAA,CAAW,CAAG,SAAC3B,CAAD,CAAU,CACjC,GAAM+B,CAAAA,CAAoB,CAAG/B,CAAI,CAACM,IAAL,CAAUC,CAAgB,CAACyB,UAAjB,CAA4BC,WAAtC,CAA7B,CACAF,CAAoB,CAACK,QAArB,CAA8B,QAA9B,EAEA,cAAEpC,CAAF,EAAQmC,GAAR,CAAY,QAAZ,CAAsB,UAAW,CAC7B,cAAE,IAAF,EAAQ7B,IAAR,CAAa,wBAAb,EAAqCG,IAArC,CAA0C,SAA1C,CAAqD,SAArD,CACH,CAFD,CAGH,CAPM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     local_booking/view_manager\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Repository from 'local_booking/repository';\nimport * as BookingsSelector from 'local_booking/selectors';\n\n/**\n * Refresh the week content.\n *\n * @param {object} root The root element.\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const refreshBookingsContent = (root, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelector.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), courseId, categoryId].join('-'));\n    return Repository.getBookingsData(courseId, categoryId)\n        .then(context => {\n            context.viewingbooking = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\n export const startLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelector.containers.loadingIcon);\n    loadingIconContainer.removeClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('disabled', 'disabled');\n    });\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nexport const stopLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelector.containers.loadingIcon);\n    loadingIconContainer.addClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('enabled', 'enabled');\n    });\n};\n"],"file":"view_manager.min.js"}