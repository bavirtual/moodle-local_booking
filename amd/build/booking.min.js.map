{"version":3,"sources":["../src/booking.js"],"names":["define","$","Templates","Notification","Repository","ViewManager","BookingSelectors","SELECTORS","ROOT","DAY","CANCEL_BUTTON","LOADING_ICON_CONTAINER","NEW_EVENT_BUTTON","BOOKING","LOADING_ICON","BOOKING_WRAPPER","TODAY","registerEventListeners","root","on","startLoading","category","find","data","course","booking","alert","cancelBooking","then","response","validationerror","bind","always","fetchNotifications","stopLoading","refreshBookingsContent","fail","exception","loadingIconContainer","containers","loadingIcon","addClass","init"],"mappings":"AAwBAA,OAAM,yBAAC,CACK,QADL,CAEK,gBAFL,CAGK,mBAHL,CAIK,0BAJL,CAKK,4BALL,CAMK,yBANL,CAAD,CAQE,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOE,IAEFC,CAAAA,CAAS,CAAG,CACZC,IAAI,CAAE,0BADM,CAEZC,GAAG,CAAE,qBAFO,CAGZC,aAAa,CAAE,+BAHH,CAIZC,sBAAsB,CAAE,0CAJZ,CAKZC,gBAAgB,CAAE,kCALN,CAMZC,OAAO,CAAE,8BANG,CAOZC,YAAY,CAAE,eAPF,CAQZC,eAAe,CAAE,iBARL,CASZC,KAAK,CAAE,QATK,CAFV,CAmBFC,CAAsB,CAAG,SAASC,CAAT,CAAe,CAExCA,CAAI,CAACC,EAAL,CAAQ,OAAR,CAAiBZ,CAAS,CAACG,aAA3B,CAA0C,UAAW,CACjDL,CAAW,CAACe,YAAZ,CAAyBF,CAAzB,EADiD,GAI3CG,CAAAA,CAAQ,CAAGH,CAAI,CAACI,IAAL,CAAUf,CAAS,CAACQ,eAApB,EAAqCQ,IAArC,CAA0C,YAA1C,CAJgC,CAK3CC,CAAM,CAAGN,CAAI,CAACI,IAAL,CAAUf,CAAS,CAACQ,eAApB,EAAqCQ,IAArC,CAA0C,UAA1C,CALkC,CAM3CE,CAAO,CAAGP,CAAI,CAACI,IAAL,CAAUf,CAAS,CAACM,OAApB,EAA6BU,IAA7B,CAAkC,WAAlC,CANiC,CAO7DG,KAAK,CAAC,uBAAyBD,CAA1B,CAAL,CAEY,MAAOrB,CAAAA,CAAU,CAACuB,aAAX,CAAyBH,CAAzB,CAAiCC,CAAjC,EACFG,IADE,CACG,SAASC,CAAT,CAAmB,CACrB,GAAIA,CAAQ,CAACC,eAAb,CAA8B,CAE1BJ,KAAK,CAAC,+CAAD,CACR,CAEJ,CANK,CAOLK,IAPK,CAOA,IAPA,CADH,EASFC,MATE,CASK,UAAW,CACf7B,CAAY,CAAC8B,kBAAb,GACA5B,CAAW,CAAC6B,WAAZ,CAAwBhB,CAAxB,EACA,MAAOb,CAAAA,CAAW,CAAC8B,sBAAZ,CAAmCjB,CAAnC,CAAyCM,CAAzC,CAAiDH,CAAjD,CACV,CAJO,CAKPU,IALO,CAKF,IALE,CATL,EAeFK,IAfE,CAeGjC,CAAY,CAACkC,SAfhB,CAgBV,CAzBD,EA4BA,GAAMC,CAAAA,CAAoB,CAAGpB,CAAI,CAACI,IAAL,CAAUhB,CAAgB,CAACiC,UAAjB,CAA4BC,WAAtC,CAA7B,CACAF,CAAoB,CAACG,QAArB,CAA8B,QAA9B,CAEH,CApDK,CAsDN,MAAO,CACHC,IAAI,CAAE,cAASxB,CAAT,CAAe,CACjBA,CAAI,CAAGjB,CAAC,CAACiB,CAAD,CAAR,CACAD,CAAsB,CAACC,CAAD,CACzB,CAJE,CAMV,CA3EK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Session Booking Plugin\n *\n * @package    local_booking\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n            'jquery',\n            'core/templates',\n            'core/notification',\n            'local_booking/repository',\n            'local_booking/view_manager',\n            'local_booking/selectors',\n        ],\n        function(\n            $,\n            Templates,\n            Notification,\n            Repository,\n            ViewManager,\n            BookingSelectors,\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DAY: \"[data-region='day']\",\n        CANCEL_BUTTON: \"[data-region='cancel-button']\",\n        LOADING_ICON_CONTAINER: '[data-region=\"loading-icon-container\"]',\n        NEW_EVENT_BUTTON: \"[data-action='new-event-button']\",\n        BOOKING: \"[data-region='booking-data']\",\n        LOADING_ICON: '.loading-icon',\n        BOOKING_WRAPPER: \".bookingwrapper\",\n        TODAY: '.today',\n    };\n\n    /**\n     * Register event listeners for the module.\n     *\n     * @param {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        // Listen the click on the Cancel booking buttons.\n        root.on('click', SELECTORS.CANCEL_BUTTON, function() {\n            ViewManager.startLoading(root);\n\n            // Get exercise id and the user id from the URL\n            const category = root.find(SELECTORS.BOOKING_WRAPPER).data('categoryid');\n            const course = root.find(SELECTORS.BOOKING_WRAPPER).data('courseid');\n            const booking = root.find(SELECTORS.BOOKING).data('bookingid');\nalert('cancelling booking::' + booking);\n            // Send the form data to the server for processing.\n            return Repository.cancelBooking(course, booking)\n                .then(function(response) {\n                    if (response.validationerror) {\n                        // eslint-disable-next-line no-alert\n                        alert('Errors encountered: Unable to cancel booking!');\n                    }\n                    return;\n                }\n                .bind(this))\n                .always(function() {\n                    Notification.fetchNotifications();\n                    ViewManager.stopLoading(root);\n                    return ViewManager.refreshBookingsContent(root, course, category);\n                }\n                .bind(this))\n                .fail(Notification.exception);\n        });\n\n        // Remove loading\n        const loadingIconContainer = root.find(BookingSelectors.containers.loadingIcon);\n        loadingIconContainer.addClass('hidden');\n\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"booking.min.js"}