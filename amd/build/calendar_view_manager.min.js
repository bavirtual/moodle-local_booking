define("local_booking/calendar_view_manager",["exports","jquery","core/templates","core/notification","local_booking/slot_actions","local_booking/modal_actions","local_booking/repository","local_booking/selectors"],(function(_exports,_jquery,_templates,_notification,_slot_actions,_modal_actions,Repository,Selectors){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * A javascript module to handler booking view changes.
   * Improvised from core_calendar.
   *
   * @module     local_booking/calendar_view_manager
   * @author     Mustafa Hajjar (mustafa.hajjar)
   * @copyright  BAVirtual.co.uk Â© 2024
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.changeWeek=async function(root,url,year,week,time,courseId){if(!_slot_actions.default.isDirty())return async function(root,year,week,time,courseId){const weekviewTarget=root.find(Selectors.wrappers.weekwrapper),weekviewTemplate=weekviewTarget.attr("data-template"),actionbarTarget=root.find(Selectors.wrappers.actionbarwrapper),actionbarTemplate=actionbarTarget.attr("data-template");let exportContext=await refreshWeekContent(root,year,week,time,courseId);return _templates.default.render(actionbarTemplate,exportContext).then(((html,js)=>_templates.default.replaceNode(actionbarTarget,html,js))).fail(_notification.default.exception),void _templates.default.render(weekviewTemplate,exportContext).then(((html,js)=>_templates.default.replaceNode(weekviewTarget,html,js))).always((()=>{_slot_actions.default.setPasteState(root),stopLoading(root)})).fail(_notification.default.exception)}(root,year,week,time,courseId).then((function(){url.length&&"#"!==url&&window.history.pushState({},"",url);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return args}));_modal_actions.default.showWarning("slotsnotsaved","slotsnotsavedtitle",{url:url,year:year,week:week,time:time,courseId:courseId},{fromComponent:!0,buttonType:"yesno"}),_slot_actions.default.clean();return!0},_exports.stopLoading=_exports.startLoading=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_slot_actions=_interopRequireDefault(_slot_actions),_modal_actions=_interopRequireDefault(_modal_actions),Repository=_interopRequireWildcard(Repository),Selectors=_interopRequireWildcard(Selectors);const refreshWeekContent=(root,year,week,time,courseId)=>{startLoading(root);const target=(0,_jquery.default)(Selectors.wrappers.calendarwrapper),action=target.data("action"),view=target.data("viewall")?"all":"user",studentId=target.data("student-id"),exerciseId=target.data("exercise-id");return time=0==time?Date.now()/1e3:time,M.util.js_pending([root.get("id"),year,week,courseId].join("-")),Repository.getCalendarWeekData(year,week,time,courseId,action,view,studentId,exerciseId).then((context=>context)).always((()=>{M.util.js_complete([root.get("id"),year,week,courseId].join("-"))})).fail(_notification.default.exception)},startLoading=root=>{root.find(Selectors.containers.loadingIcon).removeClass("hidden")};_exports.startLoading=startLoading;const stopLoading=root=>{root.find(Selectors.containers.loadingIcon).addClass("hidden")};_exports.stopLoading=stopLoading}));

//# sourceMappingURL=calendar_view_manager.min.js.map