{"version":3,"sources":["../src/modal_actions.js"],"names":["define","$","Str","Notification","ModalFactory","ModalEvents","Pending","Repository","BookingSessions","BookingSelectors","BookingActions","confirmDeletion","logentryId","userId","courseId","pendingPromise","deleteStrings","key","component","deletePromise","push","create","type","types","SAVE_CANCEL","stringsPromise","get_strings","finalPromise","when","then","strings","deleteModal","setRemoveOnClose","setTitle","setBody","setSaveButtonText","show","getRoot","on","save","deleteLogentry","trigger","deleted","resolve","always","fetchNotifications","catch","exception","modal","registerDelete","root","actions","e","logentrySource","find","logentryitem","data","preventDefault","registerRedirect","gotoFeedback"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles additional logentry modal form action.\n *\n * @module     local_booking/modal_actions\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/str',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/pending',\n    'local_booking/repository',\n    'local_booking/events',\n    'local_booking/selectors',\n    'local_booking/booking_actions',\n],\nfunction(\n    $,\n    Str,\n    Notification,\n    ModalFactory,\n    ModalEvents,\n    Pending,\n    Repository,\n    BookingSessions,\n    BookingSelectors,\n    BookingActions,\n) {\n\n    /**\n     * Prepares the action for the summary modal's delete action.\n     *\n     * @method  confirmDeletion\n     * @param   {Number} logentryId The ID of the logentry.\n     * @param   {Number} userId The user of the logentry.\n     * @param   {Number} courseId The course of the logentry.\n     * @return  {Promise}\n     */\n    var confirmDeletion = (logentryId, userId, courseId) => {\n        var pendingPromise = new Pending('local_booking/booking_actions:confirmDeletion');\n        var deleteStrings = [\n            {\n                key: 'deletelogentry',\n                component: 'local_booking'\n            },\n        ];\n\n        var deletePromise;\n        deleteStrings.push({\n            key: 'confirmlogentrydelete',\n            component: 'local_booking'\n        });\n\n\n        deletePromise = ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n        });\n\n        var stringsPromise = Str.get_strings(deleteStrings);\n\n        // Setup modal delete prompt form\n        var finalPromise = $.when(stringsPromise, deletePromise)\n        .then(function(strings, deleteModal) {\n            deleteModal.setRemoveOnClose(true);\n            deleteModal.setTitle(strings[0]);\n            deleteModal.setBody(strings[1]);\n            deleteModal.setSaveButtonText(strings[0]);\n\n            deleteModal.show();\n\n            deleteModal.getRoot().on(ModalEvents.save, function() {\n                var pendingPromise = new Pending('local_booking/booking_actions:initModal:deletedlogentry');\n                Repository.deleteLogentry(logentryId, userId, courseId)\n                    .then(function() {\n                        $('body').trigger(BookingSessions.deleted, [logentryId, false]);\n                        return;\n                    })\n                    .then(pendingPromise.resolve)\n                    .always(function() {\n                        Notification.fetchNotifications();\n                    })\n                    .catch(Notification.exception);\n            });\n\n            return deleteModal;\n        })\n        .then(function(modal) {\n            pendingPromise.resolve();\n\n            return modal;\n        })\n        .catch(Notification.exception);\n\n        return finalPromise;\n    };\n\n    /**\n     * Register the listeners required to delete the logentry.\n     *\n     * @method  registerDelete\n     * @param   {jQuery} root\n     */\n     var registerDelete = (root) => {\n        root.on('click', BookingSelectors.actions.deleteLogentry, function(e) {\n            // Fetch the logentry title, and pass them into the new dialogue.\n            var logentrySource = root.find(BookingSelectors.logentryitem),\n                logentryId = logentrySource.data('logentryId'),\n                userId = logentrySource.data('userId'),\n                courseId = logentrySource.data('courseId');\n            confirmDeletion(logentryId, userId, courseId);\n\n            e.preventDefault();\n        });\n    };\n\n    /**\n     * Register the listeners required to redirect to\n     * exercise (assignment) grading page.\n     *\n     * @method  registerRedirect\n     * @param   {jQuery} root\n     */\n     const registerRedirect = function(root) {\n        root.on('click', BookingSelectors.actions.gotoFeedback, function(e) {\n            // Call redirect to assignment feedback page\n            BookingActions.gotoFeedback(root, e);\n\n            e.preventDefault();\n        });\n    };\n\n    return {\n        registerDelete: registerDelete,\n        registerRedirect: registerRedirect\n    };\n});\n"],"file":"modal_actions.min.js"}