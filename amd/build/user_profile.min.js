define ("local_booking/user_profile",["jquery","core/str","core/notification","local_booking/repository","local_booking/selectors"],function(a,b,c,d,e){var f=function(d,f,h,i){var j=i.find(e.userprofilewrapper),k=j.data("endorsername"),l=j.data("endorser"),m=new Date,n=m.toDateString(),o=Math.round(m.getTime()/1e3),p=h?"endorsementmgs":"skilltestendorse",q=b.get_string(p,"local_booking",{endorser:k,endorsedate:n});q.then(function(b){a("#endorsement-label").html(b);if(h){a("#endorsement-letter").removeClass("hidden")}else{a("#endorsement-letter").addClass("hidden")}return b}.bind(this)).fail(c.exception);g("endorse",h,d,f,"endorse");g("endorser",h?l:"",d,f,"endorse");g("endorsedate",h?o:"",d,f,"endorse");g("endorsenotify",h,d,f,"endorse")},g=function(b,e,f,g,h){return d.updateUserPreferences(b,e,f,g).then().always(function(){c.fetchNotifications()}).fail(function(b){c.exception(b);a("#"+h).prop("checked",!a("#"+h).prop("checked"))})},h=function(b,e,f){return d.updateSuspendedStatus(b,e,f).then().always(function(){c.fetchNotifications()}).fail(function(b){c.exception(b);a("#suspended").prop("checked",!a("#suspended").prop("checked"))})},i=function(b,f,g,h,i){var j=i.find(e.userprofilewrapper),k=j.data(b+"group");return d.updateGroup(k,f,g,h).then().always(function(){c.fetchNotifications()}).fail(function(d){c.exception(d);a("#"+b).prop("checked",!a("#"+b).prop("checked"))})},j=function(b,c,d,e,j){m(a("#"+d+"-region"));switch(d){case"endorse":f(b,c,e,j);break;case"availabilityoverride":g(d,e,b,c,d);break;case"suspend":h(e,b,c);break;case"onhold":case"keepactive":i(d,e,b,c,j);break;}n(a("#"+d+"-region"))},k=function(e,f,g){m(g);var h=a("#comment").val();return d.updateProfileComment(e,f,h).then(function(d){var e=d.result;b.get_string(e?"commentsaved":"commentnotsaved","local_booking").then(function(b){a("#status").addClass("comment-status-"+(e?"success":"error"));a("#status").removeClass("comment-status-"+(!e?"success":"error"));a("#status").text(b).slideDown(1e3).delay(2e3).slideUp(1e3)}).fail(c.exception)}).always(function(){c.fetchNotifications();n(g)}).fail(c.exception)},l=function(b){var c=b.find(e.userprofilewrapper),d=c.data("courseid"),f=c.data("userid");a("#endorse").click(function(){j(d,f,"endorse",this.checked,b)});a("#suspended").click(function(){j(d,f,"suspend",this.checked)});a("#onhold").click(function(){j(d,f,"onhold",this.checked,b)});a("#keepactive").click(function(){j(d,f,"keepactive",this.checked,b)});a("#availabilityoverride").click(function(){j(d,f,"availabilityoverride",this.checked,b)});a("#save_comment_button").click(function(){k(d,f,b)})},m=function(a){var b=a.find(e.containers.loadingIcon);b.removeClass("hidden")},n=function(a){var b=a.find(e.containers.loadingIcon);b.addClass("hidden")};return{init:function init(b){b=a(b);l(b)}}});
//# sourceMappingURL=user_profile.min.js.map
