define ("local_booking/booking_actions",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core/pending","local_booking/modal_logentry_form","local_booking/repository","local_booking/events","local_booking/modal_delete","local_booking/selectors","local_booking/view_manager"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(d,e){var f=new i("local_booking/logentry_actions:confirmDeletion"),j=[{key:"deletelogentry",component:"local_booking"}],m;j.push({key:"confirmlogentrydelete",component:"local_booking",param:e});m=g.create({type:g.types.SAVE_CANCEL});var n=b.get_strings(j),o=a.when(n,m).then(function(b,e){e.setRemoveOnClose(!0);e.setTitle(b[0]);e.setBody(b[1]);e.setSaveButtonText(b[0]);e.show();e.getRoot().on(h.save,function(){var b=new i("local_booking/logentry_actions:initModal:deletedlogentry");k.deleteLogentry(d,!1).then(function(){a("body").trigger(l.deleted,[d,!1])}).then(b.resolve).catch(c.exception)});e.getRoot().on(l.deleteAll,function(){var b=new i("local_booking/logentry_actions:initModal:deletedalllogentry");k.deleteLogentry(d,!0).then(function(){a("body").trigger(l.deleted,[d,!0])}).then(b.resolve).catch(c.exception)});return e}).then(function(a){f.resolve();return a}).catch(c.exception);return o}return{registerRedirect:function(b){b.on("click",n.actions.gotoFeedback,function(c){var d=b.find(n.logentryItem),e=d.data("exerciseId"),f=d.data("studentId");a("body").trigger(l.gotoFeedback,[e]);location.href=M.cfg.wwwroot+"/mod/assign/view.php?id="+e+"&rownum=0&userid="+f+"&action=grader";c.preventDefault()})},registerRemove:function(b){b.on("click",n.actions.remove,function(b){var c=a(this).closest(n.logentryItem),d=c.data("logentrytId"),e=c.data("logentrytTitle");p(d,e);b.preventDefault()})},registerEditListeners:function(b,d){var e=new i("local_booking/logentry_actions:registerEditListeners");return d.then(function(c){a("body").on(l.editLogentry,function(a,d,e){var f=b.find(n.progressionwrapper);c.setLogentryId(d);c.setStudentId(e);c.setCourseId(f.data("courseid"));c.setContextId(f.data("contextId"));c.show();a.stopImmediatePropagation()});return c}).then(function(a){e.resolve();return a}).catch(c.exception)},registerLogentryFormModal:function registerLogentryFormModal(b){var d=g.create({type:j.TYPE,large:!0});b.on("click",n.actions.edit,function(b){b.preventDefault();var e=a(b.currentTarget),f=e.closest(n.progressionwrapper),g=e.closest(n.logentryItem);d.then(function(a){a.setLogentryId(g.data("logentrytId"));a.setStudentId(g.data("studentId"));a.setCourseId(f.data("courseId"));a.setContextId(f.data("contextId"));a.show();b.stopImmediatePropagation()}).fail(c.exception)});return d},cancelBooking:function cancelBooking(b,d,e){o.startLoading(b);var f=d.target,g=g||b.find(n.progressionwrapper).data("courseid"),h=f.dataset.bookingid;return k.cancelBooking(h,e).then(function(a){if(a.validationerror){alert("Errors encountered: Unable to cancel booking!")}}).always(function(){a("body").trigger(l.canceled,[b,!1]);c.fetchNotifications();o.stopLoading(b)}).fail(c.exception)}}});
//# sourceMappingURL=booking_actions.min.js.map
