define ("local_booking/modal_logentry_form",["jquery","core/event","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/fragment","local_booking/events","local_booking/repository","local_booking/selectors"],function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={SAVE_BUTTON:"[data-action=\"save\"]",LOADING_ICON_CONTAINER:"[data-region=\"loading-icon-container\"]"},n=function(a){f.call(this,a);this.logentryId=null;this.flightDate=null;this.exerciseId=null;this.courseId=null;this.contextId=null;this.userId=null;this.isAdditional=null;this.reloadingBody=!1;this.reloadingTitle=!1;this.saveButton=this.getFooter().find(m.SAVE_BUTTON)};n.TYPE="local_booking-modal_logentry_form";n.prototype=Object.create(f.prototype);n.prototype.constructor=n;n.prototype.setContextId=function(a){this.contextId=a};n.prototype.getContextId=function(){return this.contextId};n.prototype.setCourseId=function(a){this.courseId=a};n.prototype.getCourseId=function(){return this.courseId};n.prototype.hasCourseId=function(){return null!==this.courseId};n.prototype.setExerciseId=function(a){this.exerciseId=a};n.prototype.getExerciseId=function(){return this.exerciseId};n.prototype.hasExerciseId=function(){return null!==this.exerciseId};n.prototype.setUserId=function(a){this.userId=a};n.prototype.getUserId=function(){return this.userId};n.prototype.hasUserId=function(){return null!==this.userId};n.prototype.setLogentryId=function(a){this.logentryId=a};n.prototype.getLogentryId=function(){return this.logentryId};n.prototype.hasLogentryId=function(){return null!==this.logentryId&&0!=this.logentryId};n.prototype.setFlightDate=function(a){this.flightDate=a};n.prototype.getFlightDate=function(){return this.flightDate};n.prototype.hasFlightDate=function(){return null!==this.flightDate};n.prototype.setAdditionalEntry=function(a){this.isAdditional=a};n.prototype.isAdditionalEntry=function(){return this.isAdditional};n.prototype.getForm=function(){return this.getBody().find("form")};n.prototype.disableButtons=function(){this.saveButton.prop("disabled",!0)};n.prototype.enableButtons=function(){this.saveButton.prop("disabled",!1)};n.prototype.reloadTitleContent=function(){if(this.reloadingTitle){return this.titlePromise}this.reloadingTitle=!0;if(this.hasLogentryId()){this.titlePromise=c.get_string("editlogentry","local_booking")}else{this.titlePromise=c.get_string("newlogentry","local_booking")}this.titlePromise.then(function(a){this.setTitle(a);return a}.bind(this)).always(function(){this.reloadingTitle=!1}.bind(this)).fail(d.exception);return this.titlePromise};n.prototype.reloadBodyContent=function(b){if(this.reloadingBody){return this.bodyPromise}this.reloadingBody=!0;this.disableButtons();var c={};if(this.hasUserId()){c.userid=this.getUserId()}if(this.hasLogentryId()){c.logentryid=this.getLogentryId()}if(this.hasFlightDate()){c.flightdate=this.getFlightDate()}if(this.hasCourseId()){c.courseid=this.getCourseId()}if(this.hasExerciseId()){c.exerciseid=this.getExerciseId()}if("undefined"!=typeof b){c.formdata=b}this.bodyPromise=h.loadFragment("local_booking","logentry_form",this.getContextId(),c);this.setBody(this.bodyPromise);this.bodyPromise.then(function(){this.enableButtons();a(document).ready(function(){if("Dual"==a(k.bookingwrapper).data("trainingtype")){Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_dualtime"))}else{Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_multipilottime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_copilottime"))}Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_sessiontime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_pictime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_instructortime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_checkpilottime"));Inputmask({regex:"^([01]?[0-9]|2[0-3]):[0-5][0-9]"}).mask(document.getElementById("id_deptime"));Inputmask({regex:"^([01]?[0-9]|2[0-3]):[0-5][0-9]"}).mask(document.getElementById("id_arrtime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_nighttime"));Inputmask({regex:"^([0]?[0-4]):([0-5]?[0-9])$"}).mask(document.getElementById("id_ifrtime"));Inputmask({regex:"[0-9]"}).mask(document.getElementById("id_landingsday"));Inputmask({regex:"[0-9]"}).mask(document.getElementById("id_landingsnight"))})}.bind(this)).fail(d.exception).always(function(){this.reloadingBody=!1}.bind(this)).fail(d.exception);return this.bodyPromise};n.prototype.applyFlightRules=function(a){window.console.log("working for "+a)};n.prototype.reloadAllContent=function(){return a.when(this.reloadTitleContent(),this.reloadBodyContent())};n.prototype.show=function(){this.reloadAllContent();f.prototype.show.call(this)};n.prototype.hide=function(){f.prototype.hide.call(this);this.setLogentryId(null);this.setFlightDate(null);this.setContextId(null);this.setCourseId(null);this.setExerciseId(null)};n.prototype.getFormData=function(){return this.getForm().serialize()};n.prototype.save=function(){var b,c=this.saveButton.find(m.LOADING_ICON_CONTAINER);b=this.getForm().find("[aria-invalid=\"true\"]");if(b.length){b.first().focus();return}c.removeClass("hidden");this.disableButtons();var e=this.getFormData(),f="contextid="+this.contextId+"&courseid="+this.courseId+"&exerciseid="+this.exerciseId+"&userid="+this.userId;return j.submitCreateUpdateLogentryForm(f,e).then(function(b){if(b.validationerror){this.reloadBodyContent(e)}else{var c=this.hasLogentryId(),d=this.isAdditionalEntry();this.hide();if(c){a("body").trigger(i.updated,[b.logentry])}else if(!d){a("body").trigger(i.created,[b.logentry])}}}.bind(this)).always(function(){c.addClass("hidden");d.fetchNotifications();this.enableButtons()}.bind(this)).fail(d.exception)};n.prototype.registerEventListeners=function(){f.prototype.registerEventListeners.call(this);this.getModal().on(e.events.activate,m.SAVE_BUTTON,function(a,b){this.getForm().submit();b.originalEvent.preventDefault();a.stopPropagation()}.bind(this));this.getModal().on("submit",function(a){b.notifyFormSubmitAjax(this.getForm()[0]);this.save();a.preventDefault();a.stopPropagation()}.bind(this))};if(!l){g.register(n.TYPE,n,"local_booking/modal_logentry_form");l=!0}return n});
//# sourceMappingURL=modal_logentry_form.min.js.map
