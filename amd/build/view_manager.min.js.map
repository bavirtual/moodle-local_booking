{"version":3,"sources":["../src/view_manager.js"],"names":["registerEventListeners","root","on","BookingsSelectors","links","navLink","e","wrapper","find","courseId","data","categoryId","link","currentTarget","changeWeek","href","dataset","year","week","time","preventDefault","viewSelector","CustomEvents","define","events","activate","option","target","classList","contains","courseid","categoryid","refreshWeekContent","then","window","history","pushState","fail","Notification","exception","template","startLoading","attr","M","util","js_pending","get","join","action","view","studentId","exerciseId","Date","now","Repository","getCalendarWeekData","context","viewingmonth","Templates","render","html","js","replaceNode","always","js_complete","SlotActions","setPasteState","setBookState","stopLoading","url","length","args","reloadCurrentMonth","reloadCurrentUpcoming","getCalendarUpcomingData","viewingupcoming","cancelBooking","bookingId","bookingid","response","validationerror","alert","refreshBookingsContent","bind","fetchNotifications","getBookingsData","viewingbooking","loadingIconContainer","containers","loadingIcon","removeClass","one","addClass","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     local_booking/view_manager\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Repository from 'local_booking/repository';\nimport * as BookingsSelectors from 'local_booking/selectors';\nimport SlotActions from 'local_booking/slot_actions';\nimport CustomEvents from 'core/custom_interaction_events';\n\n/**\n * Register event listeners for the module.\n *\n * @param {object} root The root element.\n */\n const registerEventListeners = (root) => {\n    root = $(root);\n\n    root.on('click', BookingsSelectors.links.navLink, (e) => {\n        const wrapper = root.find(BookingsSelectors.wrapper);\n        const courseId = wrapper.data('courseid');\n        const categoryId = wrapper.data('categoryid');\n        const link = e.currentTarget;\n\n        changeWeek(root, link.href, link.dataset.year, link.dataset.week, link.dataset.time, courseId, categoryId);\n        e.preventDefault();\n    });\n\n    const viewSelector = root.find(BookingsSelectors.viewSelector);\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n    viewSelector.on(\n        CustomEvents.events.activate,\n        (e) => {\n            e.preventDefault();\n\n            const option = e.target;\n            if (option.classList.contains('active')) {\n                return;\n            }\n\n            const year = option.dataset.year,\n                week = option.dataset.week,\n                time = option.dataset.time,\n                courseId = option.dataset.courseid,\n                categoryId = option.dataset.categoryid;\n\n            refreshWeekContent(root, year, week, time, courseId, categoryId, root, 'local_booking/calendar_week')\n                .then(() => {\n                    return window.history.pushState({}, '', '?view=user');\n                }).fail(Notification.exception);\n        }\n    );\n};\n\n/**\n * Refresh the week content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} week week\n * @param {number} time The timestamp of the begining current week\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\n export const refreshWeekContent = (root, year, week, time, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, week, courseId].join('-'));\n\n    const action = target.data('action');\n    const view = target.data('viewall') ? 'all' : 'user';\n    const studentId = target.data('student-id');\n    const exerciseId = target.data('exercise-id');\n    time = time == 0 ? Date.now() / 1000 : time;\n    return Repository.getCalendarWeekData(year, week, time, courseId, categoryId, action, view, studentId, exerciseId)\n        .then(context => {\n            context.viewingmonth = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, week, courseId].join('-'));\n            SlotActions.setPasteState(root);\n            SlotActions.setBookState(root, action);\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The container element\n * @param {string} url The calendar url to be shown\n * @param {number} year Year\n * @param {number} week week\n * @param {number} time The timestamp of the begining current week\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const changeWeek = (root, url, year, week, time, courseId, categoryId) => {\n    return refreshWeekContent(root, year, week, time, courseId, categoryId, null, '')\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                window.history.pushState({}, '', url);\n            }\n            return args;\n        });\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\n    const year = root.find(BookingsSelectors.wrapper).data('year');\n    const week = root.find(BookingsSelectors.wrapper).data('week');\n    const time = root.find(BookingsSelectors.wrapper).data('time');\n\n    courseId = courseId || root.find(BookingsSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(BookingsSelectors.wrapper).data('categoryid');\n\n    return refreshWeekContent(root, year, week, time, courseId, categoryId, null, '');\n};\n\n/**\n * Reload the current week view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\n export const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelectors.wrapper);\n    template = template || root.attr('data-template');\n    courseId = courseId || root.find(BookingsSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(BookingsSelectors.wrapper).data('categoryid');\n\n    return Repository.getCalendarUpcomingData(courseId, categoryId)\n        .then((context) => {\n            context.viewingupcoming = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(function() {\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Cancel a specific booking and update UI.\n *\n * @method cancelBooking\n * @param {object} root The My Bookings root element\n * @param {object} e    The click event on the Cancel button\n * @return {object} The create modal promise\n */\nexport const cancelBooking = (root, e) => {\n    startLoading(root);\n\n    var target = e.target;\n    // Get exercise id and the user id from the URL\n    const courseId = courseId || root.find(BookingsSelectors.wrapper).data('courseid');\n    const bookingId = target.dataset.bookingid;\n\n    // Send the request data to the server for processing.\n    return Repository.cancelBooking(bookingId)\n        .then(function(response) {\n            if (response.validationerror) {\n                // eslint-disable-next-line no-alert\n                alert('Errors encountered: Unable to cancel booking!');\n            }\n            return refreshBookingsContent(root, courseId);\n        }\n        .bind(this))\n        .always(function() {\n            Notification.fetchNotifications();\n            stopLoading(root);\n        }\n        .bind(this))\n        .fail(Notification.exception);\n};\n\n/**\n * Refresh bookings content.\n *\n * @param {object} root The root element.\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const refreshBookingsContent = (root, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(BookingsSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), courseId, categoryId].join('-'));\n    return Repository.getBookingsData(courseId, categoryId)\n        .then((context) => {\n            context.viewingbooking = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\n export const startLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelectors.containers.loadingIcon);\n    loadingIconContainer.removeClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('disabled', 'disabled');\n    });\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nexport const stopLoading = (root) => {\n    const loadingIconContainer = root.find(BookingsSelectors.containers.loadingIcon);\n    loadingIconContainer.addClass('hidden');\n\n    $(root).one('submit', function() {\n        $(this).find('input[type=\"submit\"]').attr('enabled', 'enabled');\n    });\n};\n\nexport const init = (root, view) => {\n    registerEventListeners(root, view);\n};"],"file":"view_manager.min.js"}