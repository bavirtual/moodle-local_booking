function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_booking/view_manager",["exports","jquery","core/templates","core/notification","local_booking/repository","local_booking/selectors","/slot_actions","core/custom_interaction_events"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=a.stopLoading=a.startLoading=a.refreshBookingsContent=a.cancelBooking=a.reloadCurrentUpcoming=a.reloadCurrentMonth=a.changeWeek=a.refreshWeekContent=void 0;b=l(b);c=l(c);d=l(d);f=k(f);g=k(g);h=l(h);i=l(i);var m=void 0;function j(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;j=function(){return a};return a}function k(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=j();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function l(a){return a&&a.__esModule?a:{default:a}}var n=function(a){a=(0,b.default)(a);a.on("click",g.links.navLink,function(b){var c=a.find(g.wrapper),d=c.data("courseid"),e=c.data("categoryid"),f=b.currentTarget;p(a,f.href,f.dataset.year,f.dataset.week,f.dataset.time,d,e);b.preventDefault()});var c=a.find(g.viewSelector);i.default.define(c,[i.default.events.activate]);c.on(i.default.events.activate,function(b){b.preventDefault();var c=b.target;if(c.classList.contains("active")){return}var e=c.dataset.year,f=c.dataset.week,g=c.dataset.time,h=c.dataset.courseid,i=c.dataset.categoryid;o(a,e,f,g,h,i,a,"local_booking/calendar_week").then(function(){return window.history.pushState({},"","?view=user")}).fail(d.default.exception)})},o=function(a,b,e,i,j,k){var l=6<arguments.length&&arguments[6]!==void 0?arguments[6]:null,m=7<arguments.length&&arguments[7]!==void 0?arguments[7]:"";u(a);l=l||a.find(g.wrapper);m=m||a.attr("data-template");M.util.js_pending([a.get("id"),b,e,j].join("-"));var n=l.data("action"),o=l.data("viewall")?"all":"user",p=l.data("student-id"),q=l.data("exercise-id");i=0==i?Date.now()/1e3:i;return f.getCalendarWeekData(b,e,i,j,k,n,o,p,q).then(function(a){a.viewingmonth=!0;return c.default.render(m,a)}).then(function(a,b){return c.default.replaceNode(l,a,b)}).always(function(){M.util.js_complete([a.get("id"),b,e,j].join("-"));h.default.setPasteState(a);h.default.setBookState(a,n);return v(a)}).fail(d.default.exception)};a.refreshWeekContent=o;var p=function(a,b,c,d,e,f,g){return o(a,c,d,e,f,g,null,"").then(function(){if(b.length&&"#"!==b){window.history.pushState({},"",b)}for(var a=arguments.length,c=Array(a),d=0;d<a;d++){c[d]=arguments[d]}return c})};a.changeWeek=p;var q=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,d=a.find(g.wrapper).data("year"),e=a.find(g.wrapper).data("week"),f=a.find(g.wrapper).data("time");b=b||a.find(g.wrapper).data("courseid");c=c||a.find(g.wrapper).data("categoryid");return o(a,d,e,f,b,c,null,"")};a.reloadCurrentMonth=q;var r=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:"";u(a);h=h||a.find(g.wrapper);i=i||a.attr("data-template");b=b||a.find(g.wrapper).data("courseid");e=e||a.find(g.wrapper).data("categoryid");return f.getCalendarUpcomingData(b,e).then(function(a){a.viewingupcoming=!0;return c.default.render(i,a)}).then(function(a,b){return c.default.replaceNode(h,a,b)}).always(function(){return v(a)}).fail(d.default.exception)};a.reloadCurrentUpcoming=r;var s=function(a,b){u(a);var c=b.target,e=e||a.find(g.wrapper).data("courseid"),h=c.dataset.bookingid;return f.cancelBooking(h).then(function(b){if(b.validationerror){alert("Errors encountered: Unable to cancel booking!")}return t(a,e)}.bind(m)).always(function(){d.default.fetchNotifications();v(a)}.bind(m)).fail(d.default.exception)};a.cancelBooking=s;var t=function(a,b,e){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:"";u(a);h=h||a.find(g.wrapper);i=i||a.attr("data-template");M.util.js_pending([a.get("id"),b,e].join("-"));return f.getBookingsData(b,e).then(function(a){a.viewingbooking=!0;return c.default.render(i,a)}).then(function(a,b){return c.default.replaceNode(h,a,b)}).always(function(){M.util.js_complete([a.get("id"),b,e].join("-"));return v(a)}).fail(d.default.exception)};a.refreshBookingsContent=t;var u=function(a){var c=a.find(g.containers.loadingIcon);c.removeClass("hidden");(0,b.default)(a).one("submit",function(){(0,b.default)(this).find("input[type=\"submit\"]").attr("disabled","disabled")})};a.startLoading=u;var v=function(a){var c=a.find(g.containers.loadingIcon);c.addClass("hidden");(0,b.default)(a).one("submit",function(){(0,b.default)(this).find("input[type=\"submit\"]").attr("enabled","enabled")})};a.stopLoading=v;a.init=function init(a,b){n(a,b)}});
//# sourceMappingURL=view_manager.min.js.map
