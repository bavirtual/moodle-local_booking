define ("local_booking/booking_actions",["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core/pending","local_booking/modal_logentry_form","local_booking/repository","local_booking/events","local_booking/modal_delete","local_booking/selectors","local_booking/booking_view_manager"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(d,e,f){var j=new i("local_booking/booking_actions:confirmDeletion"),m=[{key:"deletelogentry",component:"local_booking"}],n;m.push({key:"confirmlogentrydelete",component:"local_booking"});n=g.create({type:g.types.SAVE_CANCEL});var o=b.get_strings(m),p=a.when(o,n).then(function(b,g){g.setRemoveOnClose(!0);g.setTitle(b[0]);g.setBody(b[1]);g.setSaveButtonText(b[0]);g.show();g.getRoot().on(h.save,function(){var b=new i("local_booking/booking_actions:initModal:deletedlogentry");k.deleteLogentry(d,e,f).then(function(){a("body").trigger(l.deleted,[d,!1])}).then(b.resolve).catch(c.exception)});return g}).then(function(a){j.resolve();return a}).catch(c.exception);return p};return{registerBookingConfirm:function registerBookingConfirm(a){a.on("click",n.actions.bookingConfirm,function(b){var c=a.find(n.logentryItem),d=c.data("exercise-id"),e=a.find(n.bookingwrapper).data("courseid"),f=a.find(n.bookingwrapper).data("studentid"),g=a.find(n.bookingwrapper).data("week");location.href="".concat(M.cfg.wwwroot,"/local/booking/availability.php?courseid=\n                ").concat(e,"&exid=").concat(d,"&userid=").concat(f,"&action=book&time=").concat(g,"&view=user");b.preventDefault()})},registerRedirect:function registerRedirect(b){b.on("click",n.actions.gotoFeedback,function(c){var d=b.find(n.logentryItem),e=d.data("courseId"),f=d.data("exerciseId"),g=d.data("userId");a("body").trigger(l.gotoFeedback,[f]);location.href=M.cfg.wwwroot+"/local/booking/assign.php?courseid="+e+"&exeid="+f+"&rownum=0&userid="+g;c.preventDefault()})},registerDelete:function registerDelete(a){a.on("click",n.actions.deleteLogentry,function(b){var c=a.find(n.logentryItem),d=c.data("logentryId"),e=c.data("userId"),f=c.data("courseId");p(d,e,f);b.preventDefault()})},cancelBooking:function cancelBooking(d,f,e){o.startLoading(d);var g=f.target,h=h||d.find(n.bookingwrapper).data("courseid"),i=g.dataset.bookingid;return k.cancelBooking(i,e).then(function(a){if(a.validationerror){alert(b.get_string("errorlogentrycancel","local_booking"))}}).always(function(){a("body").trigger(l.canceled,[d,!1]);c.fetchNotifications();o.stopLoading(d)}).fail(c.exception)},overrideRestriction:function overrideRestriction(a){o.startLoading(a);var d=a.find(n.bookConfirmation).data("studentid");return k.overrideWaitRestriction(d).then(function(a){if(a.validationerror){alert(b.get_string("bookingavailabilityoverrideunable","local_booking"))}}).always(function(){c.fetchNotifications();o.stopLoading(a)}).fail(c.exception)},registerLogentryFormModal:function registerLogentryFormModal(){var a=g.create({type:j.TYPE,large:!0});return a},registerActionListeners:function registerActionListeners(b,d){var e=new i("local_booking/booking_actions:registerActionListeners");return d.then(function(c){a("body").on(l.addLogentry,function(a,d,e,f){var g=b.find(n.bookingwrapper);c.setSessionDate(f);c.setExerciseId(d);c.setUserId(e);c.setCourseId(g.data("courseid"));c.setContextId(g.data("contextid"));c.show();a.stopImmediatePropagation()});a("body").on(l.editLogentry,function(a,d,e,f){var g=b.find(n.bookingwrapper);c.setSessionDate(f);c.setLogentryId(d);c.setUserId(e);c.setCourseId(g.data("courseid"));c.setContextId(g.data("contextid"));c.show();a.stopImmediatePropagation()});return c}).then(function(a){e.resolve();return a}).catch(c.exception)}}});
//# sourceMappingURL=booking_actions.min.js.map
