function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_booking/booking_view_manager",["exports","jquery","core/str","core/templates","core/notification","core/pending","core/modal_factory","core/modal_events","local_booking/modal_logentry_summary","local_booking/repository","local_booking/selectors"],(function(_exports,_jquery,Str,_templates,_notification,_pending,_modal_factory,_modal_events,_modal_logentry_summary,Repository,Selectors){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * This module handles session booking and logentry view changes.
   *
   * @module     local_booking/booking_view_manager
   * @author     Mustafa Hajjar (mustafahajjar@gmail.com)
   * @copyright  BAVirtual.co.uk Â© 2021
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.stopLoading=_exports.startLoading=_exports.renderLogentrySummaryModal=_exports.renderLogentryModal=_exports.refreshBookingsContent=void 0,_jquery=_interopRequireDefault(_jquery),Str=_interopRequireWildcard(Str),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_modal_logentry_summary=_interopRequireDefault(_modal_logentry_summary),Repository=_interopRequireWildcard(Repository),Selectors=_interopRequireWildcard(Selectors);_exports.refreshBookingsContent=function(root,courseId,categoryId){var target=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,filter=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;startLoading(root);var bookingsContext,template=root.attr("data-template"),mybookingstarget=root.find(Selectors.mybookingswrapper);return target=target||root.find(Selectors.bookingwrapper),courseId=courseId||root.find(Selectors.bookingwrapper).data("courseid"),filter=filter||"active",M.util.js_pending([root.get("id"),courseId,categoryId].join("-")),Repository.getBookingsData(courseId,filter).then((function(context){return context.viewingbooking=!0,bookingsContext=context,_templates.default.render(template,context)})).then((function(html,js){return _templates.default.replaceNode(target,html,js)})).then((function(){return _templates.default.render("local_booking/my_bookings",bookingsContext)})).then((function(html,js){return _templates.default.replaceNode(mybookingstarget,html,js)})).always((function(){return M.util.js_complete([root.get("id"),courseId,categoryId].join("-")),stopLoading(root)})).fail(_notification.default.exception)};_exports.renderLogentryModal=function(root,e,LogentryFormPromise,target,contextId,courseId,userId,logentryId,isNew,template){var pendingPromise=new _pending.default("local_booking/booking_view_manager:renderLogentryModal");return LogentryFormPromise.then((function(modal){return LogentryFormPromise.then((function(modal){var logegntrySession,flightDate,exerciseId,flightType,findpirepenabled;if(isNew)flightDate=(logegntrySession=target.closest(Selectors.actions.viewLogEntry)).dataset.flightDate,exerciseId=logegntrySession.dataset.exerciseId,flightType=logegntrySession.dataset.flightType,findpirepenabled=(0,_jquery.default)(Selectors.bookingwrapper).data("findpirep");else if("local_booking/logbook_std"==template){var _logegntrySession=target.closest(Selectors.containers.summaryForm);flightDate=_logegntrySession.dataset.flightDate,exerciseId=_logegntrySession.dataset.exerciseId,flightType=_logegntrySession.dataset.flightType}else flightDate=(logegntrySession=root.find(Selectors.containers.summaryForm)).data("flight-date"),exerciseId=logegntrySession.data("exercise-id"),flightType=logegntrySession.data("flight-type"),findpirepenabled=logegntrySession.data("find-pirep");modal.setContextId(contextId),modal.setCourseId(courseId),modal.setUserId(userId),modal.setLogentryId(logentryId),modal.setExerciseId(exerciseId),modal.setFlightDate(flightDate),modal.setFlightType(flightType),modal.hasFindPIREP(findpirepenabled),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),e.stopImmediatePropagation()})).fail(_notification.default.exception),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)};_exports.renderLogentrySummaryModal=function(courseId,userId,logentryId){var pendingPromise=new _pending.default("local_booking/booking_view_manager:renderLogentrySummaryModal");return Repository.getLogentryById(logentryId,courseId,userId).then((function(getEventResponse){if(!getEventResponse.logentry)throw new Error(Str.get_string("errorlogentryfetch","local_booking")+logentryId);return getEventResponse.logentry})).then((function(logentryData){var modalParams={title:Str.get_string("logentry","local_booking"),type:_modal_logentry_summary.default.TYPE,body:_templates.default.render("local_booking/logentry_summary_body",logentryData)};return _modal_factory.default.create(modalParams)})).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal.show(),modal})).then((function(modal){return pendingPromise.resolve(),modal})).catch(_notification.default.exception)};var startLoading=function(root){root.find(Selectors.containers.loadingIcon).removeClass("hidden"),(0,_jquery.default)(root).one("submit",(function(){(0,_jquery.default)(this).find('input[type="submit"]').attr("disabled","disabled")}))};_exports.startLoading=startLoading;var stopLoading=function(root){root.find(Selectors.containers.loadingIcon).addClass("hidden"),(0,_jquery.default)(root).one("submit",(function(){(0,_jquery.default)(this).find('input[type="submit"]').attr("enabled","enabled")}))};_exports.stopLoading=stopLoading}));

//# sourceMappingURL=booking_view_manager.min.js.map