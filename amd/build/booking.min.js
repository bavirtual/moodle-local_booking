/**
 * This module is responsible for registering listeners
 * for all session booking and logentry events.
 *
 * @module     local_booking/booking
 * @author     Mustafa Hajjar (mustafa.hajjar)
 * @copyright  BAVirtual.co.uk Â© 2024
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_booking/booking",["jquery","core/pending","local_booking/booking_view_manager","local_booking/booking_actions","local_booking/events","local_booking/logentry_edit_modal","local_booking/selectors"],(function($,Pending,ViewManager,BookingActions,BookingEvents,ModalLogentryEditForm,Selectors){const registerSessionEventListeners=root=>{const contextId=$(Selectors.wrappers.bookingwrapper).data("contextid"),courseId=$(Selectors.wrappers.bookingwrapper).data("courseid");contextId&&root.on("click",Selectors.actions.viewLogEntry,(function(e){let logentryId=$(this).attr("data-logentry-id"),sessionId=$(this).attr("data-session-id"),userId=$(this).attr("data-student-id");e.preventDefault(),e.stopPropagation(),0==sessionId?BookingActions.gotoFeedback(root,e):0==logentryId?registerLogentryEditForm(null,e,contextId,courseId,userId,logentryId,!0):registerLogentrySummaryForm(contextId,courseId,userId,logentryId),e.stopImmediatePropagation()}))},registerLogentryEditForm=(root,e,contextId,courseId,userId,logentryId,isNew)=>{const LogentryFormPromise=ModalLogentryEditForm.create(),target=e.target,pendingPromise=new Pending("local_booking/registerLogentryEditForm");ViewManager.renderLogentryEditForm(root,e,LogentryFormPromise,target,contextId,courseId,userId,logentryId,isNew).then(pendingPromise.resolve()).catch(e)},registerLogentrySummaryForm=(contextId,courseId,userId,logentryId)=>{const pendingPromise=new Pending("local_booking/registerLogentrySummaryForm");logentryId?ViewManager.renderLogentrySummaryModal(courseId,userId,logentryId).then((function(modal){return $("body").on(BookingEvents.editLogentry,(function(e,userId,logentryId){registerLogentryEditForm(modal.getRoot(),e,contextId,courseId,userId,logentryId),e.stopImmediatePropagation()})),$("body").on(BookingEvents.addLogentry,(function(e,userId){registerLogentryEditForm(modal.getRoot(),e,contextId,courseId,userId,0),e.stopImmediatePropagation()})),modal})).then(pendingPromise.resolve()).catch(window.console.error):pendingPromise.resolve()},registerEventListeners=function(root){!function(root){const body=$("body");body.on(BookingEvents.bookingCanceled+" "+BookingEvents.noshowProcessed,(function(){ViewManager.refreshBookingsContent(root)})),body.on(BookingEvents.logentryCreated,(function(){ViewManager.refreshBookingsContent(root)})),body.on(BookingEvents.logentryUpdated,(function(){ViewManager.refreshBookingsContent(root)})),body.on(BookingEvents.logentryDeleted,(function(){ViewManager.refreshBookingsContent(root)})),root.on("click",Selectors.actions.gotoFeedback,(function(e){BookingActions.gotoFeedback(root,e),e.preventDefault()}))}(root),registerSessionEventListeners(root)};return{init:function(rt){var root=$(rt);registerEventListeners(root),ViewManager.stopLoading(root)}}}));

//# sourceMappingURL=booking.min.js.map