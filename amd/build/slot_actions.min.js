define ("local_booking/slot_actions",["jquery","core/notification","local_booking/repository","local_booking/calendar_view_manager"],function(a,b,c,d){var j={CALENDAR_WRAPPER:"[class=calendarwrapper]",SLOTS_TABLE:"[data-region=\"slots-week\"]",SLOT_DAY:"[data-region=\"day\"]",SAVE_BUTTON:"[data-region=\"save-button\"]",PASTE_BUTTON:"[data-region='paste-button']",BOOK_BUTTON:"[data-region='book-button']",LOADING_ICON_CONTAINER:"[data-region=\"loading-icon-container\"]"},k=[],l,m=[];function e(a){d.startLoading(a);var e=a.find(j.CALENDAR_WRAPPER).data("courseid"),g=a.find(j.CALENDAR_WRAPPER).data("exercise-id"),h=a.find(j.CALENDAR_WRAPPER).data("student-id");f(a,"book");return c.saveBookedSlot(l,e,g,h).then(function(a){if(a.validationerror){alert("Errors encountered: Unable to save slot!")}else{location.href=M.cfg.wwwroot+"/local/booking/view.php?courseid="+e}}.bind(this)).always(function(){d.stopLoading(a)}.bind(this)).fail(b.exception)}function f(b,c){var d="book"==c?"slot-booked":"slot-marked",e=b.find(j.CALENDAR_WRAPPER).data("year"),f=b.find(j.CALENDAR_WRAPPER).data("week"),h=b.find(j.SLOTS_TABLE).attr("id"),l=a("#"+h+" th"),m=document.getElementById(h).rows[0].cells.length,n;k.length=0;l.each(function(){if("slot-week-day"==a(this).data("region")){n=l.index(this)+1;return!1}});for(var o=function(b){var c=a("#"+h+" td:nth-child("+b+")").map(function(){return[[a(this).data(d),a(this).data("slot-timestamp")]]}).get(),i={};c.forEach(function(a,b){var h=b==c.length-1;if(a[0]){if(0===Object.keys(i).length&&i.constructor===Object){i.starttime=a[1]}else{i.endtime=a[1]}}else if(!(0===Object.keys(i).length&&i.constructor===Object)){i=g(i,d,f,e)}if(h&&!(0===Object.keys(i).length&&i.constructor===Object)){i=g(i,d,f,e)}})},p=n;p<=m;p++){o(p)}}function g(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;if("slot-marked"==b){k.push(a)}else if("slot-booked"==b){a.week=c;a.year=d;l=a}return{}}function h(a){if(0<m.length){a.find(j.PASTE_BUTTON).addClass("slot-button-blue").removeClass("slot-button-gray")}else{a.find(j.PASTE_BUTTON).addClass("slot-button-gray").removeClass("slot-button-blue")}}function i(a,b){f(a,b);if("book"==b){var c=a.find(j.BOOK_BUTTON);if(l!==void 0&&0!==l.length){c.addClass("slot-button-blue").removeClass("slot-button-gray");c.prop("disabled",!1)}else{c.addClass("slot-button-gray").removeClass("slot-button-blue");c.prop("disabled",!0)}}else{var d=a.find(j.SAVE_BUTTON);if(k!==void 0&&0!==k.length){d.addClass("slot-button-blue").removeClass("slot-button-gray");d.prop("disabled",!1)}else{d.addClass("slot-button-gray").removeClass("slot-button-blue");d.prop("disabled",!0)}}}return{saveWeekSlots:function(a){d.startLoading(a);var e=a.find(j.CALENDAR_WRAPPER).data("courseid"),g=a.find(j.CALENDAR_WRAPPER).data("year"),h=a.find(j.CALENDAR_WRAPPER).data("week");f(a);return c.saveSlots(k,e,g,h).then(function(a){if(a.validationerror){alert("Errors encountered: Unable to save slot!")}}.bind(this)).always(function(){b.fetchNotifications();return d.stopLoading(a)}.bind(this)).fail(b.exception)},saveBookedSlot:e,clearWeekSlots:function(b){a("td").filter(function(){if(0==a(this).data("slot-booked")){a(this).data("slot-marked",0);a(this).removeClass("slot-selected")}});i(b,"post")},pasteSlots:function(b){var c=document.getElementById(b.find(j.SLOTS_TABLE).attr("id"));m.forEach(function(b){var d=c.rows[b[0]].cells[b[1]];a(d).data("slot-marked",1);a(d).addClass("slot-selected",1)});i(b,"post")},setPasteState:h,setSaveButtonState:i,copySlots:function(b){m.length=0;a(j.SLOT_DAY).each(function(b,c){if(a(c).data("slot-marked")){m.push([c.closest("tr").rowIndex,c.cellIndex])}});h(b)},setSlot:function(b,c,d){var e="book"==d?"slot-booked":"slot-marked",f="book"==d?"slot-booked":"slot-selected";if(!a(b).data(e)){a(b).addClass(f)}else{a(b).removeClass(f)}a(b).data(e,!a(b).data(e))},Slots:k,SlotIndexes:m}});
//# sourceMappingURL=slot_actions.min.js.map
